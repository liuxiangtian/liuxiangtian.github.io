<!DOCTYPE html>





<html lang="zh-CN,ja,en,default">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="谨守而勿失，是谓反其真">
<meta property="og:type" content="website">
<meta property="og:title" content="lxt">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="lxt">
<meta property="og:description" content="谨守而勿失，是谓反其真">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lxt">
<meta name="twitter:description" content="谨守而勿失，是谓反其真">
  <link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>lxt</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

<link rel="stylesheet" href="\assets\css\APlayer.min.css" class="aplayer-style-marker">
<script src="\assets\js\APlayer.min.js" class="aplayer-script-marker"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lxt</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a class="book-mark-link book-mark-link-fixed" href="#"></a>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/17/计算机/数据结构/哈希表/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/17/计算机/数据结构/哈希表/" class="post-title-link" itemprop="url">Hash Table</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-17 20:05:02 / 修改时间：20:05:50" itemprop="dateCreated datePublished" datetime="2019-09-17T20:05:02+08:00">2019-09-17</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机/数据结构/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>4.5k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>4 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="哈希表-Hash-Table"><a href="#哈希表-Hash-Table" class="headerlink" title="哈希表(Hash Table)"></a>哈希表(Hash Table)</h1><h3 id="哈希表的一般原理"><a href="#哈希表的一般原理" class="headerlink" title="哈希表的一般原理"></a>哈希表的一般原理</h3><p>哈希表的参照物是数组或者链表，在后者中取值或者查找总是避免不了一个循环操作，造成O(n)的开销，通过构建哈希表可以将此类操作开销降低到O(1)。</p>
<p>典型哈希表的流程如下</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/Hash_table_5_0_1_1_1_1_1_LL.svg/450px-Hash_table_5_0_1_1_1_1_1_LL.svg.png" alt="âHashTableâçå¾çæç´¢ç»æ"></p>
<p>这是一个电话号码簿，以人名作为键值(key)，将 key 值代入哈希函数得到 hash 值，通过 hash 值得到数组下标，通过下标可以在电话号码数组里直接得到号码。</p>
<p>为了这一高效过程付出的代价是</p>
<ul>
<li>哈希函数的开销，该函数必须控制计算量 </li>
<li>如果存储 hash 值，要付出额外的空间开销，例如 java 为每一个类提供 hash 属性</li>
<li>hash 表构建开销为O(n)，不过这一开销是一次性的，能够被此后表的操作所摊还；不过频繁的重建表还是要避免的</li>
</ul>
<p>此外哈希表还有两个问题</p>
<p>1.哈希函数的构造，主要是使得输出结果区间分配均匀，避免带来过多的哈希冲突</p>
<p>2.哈希冲突。上图红色部分就显示了一个 hash 冲突，两个不同的人名通过 哈希函数得到相同的 hash 值，导致他们有得到同一个电话号码的风险。</p>
<h3 id="哈希冲突的两种解决方法"><a href="#哈希冲突的两种解决方法" class="headerlink" title="哈希冲突的两种解决方法"></a>哈希冲突的两种解决方法</h3><p>不管选怎样的哈希函数，Hash 冲突都是不可避免的。为了解决这一问题，建立哈希表时可以采用两种方法</p>
<ul>
<li>分离链接法</li>
</ul>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Hash_table_5_0_1_1_1_1_0_LL.svg/1920px-Hash_table_5_0_1_1_1_1_0_LL.svg.png" alt="img"></p>
<p>buckets 中存放的元素都是链表，计算得到下标后获得此位置上的链表，将数据写入链表即可。发生 hash 冲突的数据一并都写入链表，查找时先在 buckets 数组中找链表，这一步开销是O(1)，而后在链表里找数据。</p>
<p>这种方法需要遍历链表，这一部分开销与链表平均长度有关，可以等价于装填因子有关。一般而言，装填因子可以达到 1.</p>
<ul>
<li>开放定址法 </li>
</ul>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Hash_table_5_0_1_1_1_1_0_SP.svg/1024px-Hash_table_5_0_1_1_1_1_0_SP.svg.png" alt="img"></p>
<p>这种方法不在使用链表，发生冲突后在冲突位置往后寻找一个空位安放数据。寻找安置空位的方法有 </p>
<ul>
<li>线性探测 逐个探测表，直到查找到一个空单元，把散列地址存放在该空单元。</li>
<li>平方探测 相对线性探测，相当于探测间隔 i*i 个单元的位置是否为空。</li>
<li>伪随机探测     </li>
</ul>
<p>考虑将 {89,18,49,58,69} 插入到一个散列表，散列函数是简单的除10求余数，冲突处理采用开放定址线性检测，其过程如下</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">散列地址</th>
<th style="text-align:center">空表</th>
<th style="text-align:center">插入89</th>
<th style="text-align:center">插入18</th>
<th style="text-align:center">插入49</th>
<th style="text-align:center">插入58</th>
<th style="text-align:center">插入69</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"><strong>49</strong></td>
<td style="text-align:center">49</td>
<td style="text-align:center">49</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"><strong>58</strong></td>
<td style="text-align:center">58</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"><strong>69</strong></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">18</td>
<td style="text-align:center">18</td>
<td style="text-align:center">18</td>
<td style="text-align:center">18</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center"></td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
</tr>
</tbody>
</table>
</div>
<p>如果采用平方定址法</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">散列地址</th>
<th style="text-align:center">空表</th>
<th style="text-align:center">插入89</th>
<th style="text-align:center">插入18</th>
<th style="text-align:center">插入49</th>
<th style="text-align:center">插入58</th>
<th style="text-align:center">插入69</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">49</td>
<td style="text-align:center">49</td>
<td style="text-align:center">49</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"><strong>58</strong></td>
<td style="text-align:center">58</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"><strong>69</strong></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">18</td>
<td style="text-align:center">18</td>
<td style="text-align:center">18</td>
<td style="text-align:center">18</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center"></td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
<td style="text-align:center">89</td>
</tr>
</tbody>
</table>
</div>
<p>插入 58 发生冲突，第一次寻址是偏移 1 位，但此位被占据，第二次寻址是 4 位，即所处位置。</p>
<p>开放定址的问题是随着表中元素的增多，插入寻址会变得越来越困难。当装填因子超过一定值后，插入新元素将变的不可能，这时就需要重新构造一个容积更大的哈希表，这个操作叫做<strong>再散列</strong>。使用分离链接法解决哈希冲突是没有这个问题的。</p>
<p>再散列后新表的大小一般是旧表的两倍。</p>
<p>对于开放定址法，荷载因子是特别重要因素。超过0.8，查表时的缓存不命中（cache missing）按照指数曲线上升。例如 Java 系统库限制荷载因子为0.75，超过此值将发生再散列。</p>
<h3 id="哈希表的实现"><a href="#哈希表的实现" class="headerlink" title="哈希表的实现"></a>哈希表的实现</h3><p>Python 中的字典 dict ，Java 中的 HashMap 都采用哈希表实现，以提高效率。不同的是前者采用开放定址法，后者采用分离链接法。</p>
<h4 id="Python-的字典"><a href="#Python-的字典" class="headerlink" title="Python 的字典"></a>Python 的字典</h4><p>字典的使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">teams = &#123;<span class="string">"seriaA"</span>:<span class="string">"inter"</span>, <span class="string">"Liga"</span>:<span class="string">"Barça"</span>, <span class="string">"Premier"</span>:<span class="string">"Liverpool"</span>&#125;</span><br><span class="line">teams[<span class="string">"seriaA"</span>] // inter</span><br></pre></td></tr></table></figure>
<p>python的函数函数为 hash()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash(<span class="string">"seriaA"</span>) // <span class="number">-6110547274228262006</span></span><br></pre></td></tr></table></figure>
<p>python 用一个数组来存储键/值对，其中键为索引值。索引的计算如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash(<span class="string">"seriaA"</span>) &amp; (len<span class="number">-1</span>) // len 是数组长度, &amp; 运算等价于求余</span><br></pre></td></tr></table></figure>
<p><img src="https://harveyqing.gitbooks.io/python-read-and-write/content/images/pya/probing.png" alt="probing sequence"></p>
<h4 id="Java-中的-HashMap"><a href="#Java-中的-HashMap" class="headerlink" title="Java 中的 HashMap"></a>Java 中的 HashMap</h4><p>HashMap 的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">"SeriaA"</span>, <span class="string">"inter"</span>);</span><br><span class="line">String team = map.get(<span class="string">"SeriaA"</span>);</span><br></pre></td></tr></table></figure>
<p>键值对存放的数组是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap.Node&lt;K, V&gt;[] table;</span><br></pre></td></tr></table></figure>
<p>其中 Node 定义如下，是典型的链表，说明 HashMap 采用的是分离链接法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Entry</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;    </span><br><span class="line">    <span class="keyword">int</span> hash;    </span><br><span class="line">    K key;    </span><br><span class="line">    V value;    </span><br><span class="line">    HashMap.Node&lt;K, V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行 put 操作的流程</p>
<p>1.首先利用下式计算出 key 对应的下标 i ，如果table中此位置无元素存在，那么创建 Node 节点并写入键值对即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash(key) &amp; (table.length-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p> 2.如果 table[i] 上已经有元素存在，遍历链表<strong>比对 hash值和key值</strong>，如果发现均相同的元素，则认为找到了元素，此时 put 的操作实际是 “<strong>修改已存在的元素</strong>“；如果没有找到，则此时 put 的操作实际是 “<strong>添加新元素</strong>。”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Node.hash == hash &amp;&amp; (Node.key == key || Node.key.equals(key))</span><br></pre></td></tr></table></figure>
<p>上述条件说的是只要两个元素的 <strong>hash值相同</strong>且 <strong>至少满足equal 条件</strong>，即在 HashMap 中视为同一个元素。</p>
<h4 id="ArrayMap"><a href="#ArrayMap" class="headerlink" title="ArrayMap"></a>ArrayMap</h4><p>ArrayMap 与 HashMap 相比，是实现字典的另一种思路，它已经不采用哈希表来实现。它主要有两个数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] mHashes;		<span class="comment">//存放 hash 值的数组</span></span><br><span class="line">Object[] mArray;    <span class="comment">//存放 key-vaule 的数组</span></span><br></pre></td></tr></table></figure>
<p>它的 put 操作流程是</p>
<p>1.先计算hash值和下标 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hash = key.hashCode();</span><br><span class="line"><span class="keyword">int</span> index = binarySearchHashes(mHashes, N, hash);</span><br></pre></td></tr></table></figure>
<p>2.写入数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mHashes[index] = hash;        <span class="comment">// 下标是hash数组中的下标</span></span><br><span class="line">mArray[index&lt;&lt;<span class="number">1</span>] = key;       <span class="comment">// 存放到键值对数组中要先换算下标</span></span><br><span class="line">mArray[(index&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>] = value;</span><br></pre></td></tr></table></figure>
<p>可见键值对在数组中完全是并排存放的，而由hash值到下标的计算也不再使用哈希函数，而是将其按序排列使用二分查找，这步的开销是<strong>O(log(n))</strong>，比 HashMap 要大，但比数组要小。可以想见，在处理海量数据，例如城市居民通讯录时是不能采用这种结构的。</p>
<h4 id="SparseArray"><a href="#SparseArray" class="headerlink" title="SparseArray"></a>SparseArray</h4><p>SparseArray 的使用如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SparseArray&lt;String&gt; array = <span class="keyword">new</span> SparseArray&lt;&gt;();</span><br><span class="line">array.put(<span class="number">1</span>, <span class="string">"inter"</span>);</span><br><span class="line">String team = array.get(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>主要存储结构如下，它的 key 和 value 是分开存放的，只不过 key 是特殊的 int 类型，设计这种结构是为了避免 Integer 类型的装箱和解装箱开销。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] mKeys;</span><br><span class="line"><span class="keyword">private</span> Object[] mValues;</span><br></pre></td></tr></table></figure>
<p>它的实现与 ArrayMap 类似，因为它的 key 直接是 int 类型，省去了计算 hash 值的过程。可以直接将 key 值在 mKeys 数组中进行二分查找，以获得下标。再用这个下标到 mValues 数组中获得对象。</p>
<h3 id="哈希表的应用"><a href="#哈希表的应用" class="headerlink" title="哈希表的应用"></a>哈希表的应用</h3><p>哈希表最关键的特征是，<strong>将数组的查值变成O(1)开销</strong>，因此遇到类似问题，我们应该有意识的构建哈希表。但要注意，在具体实现过程中，可能碰到 <strong>key 键重复问题</strong>。</p>
<h4 id="算法题：Two-Sum"><a href="#算法题：Two-Sum" class="headerlink" title="算法题：Two Sum"></a>算法题：Two Sum</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">   Example:</span></span><br><span class="line"><span class="string">   Given nums = [2, 7, 11, 15], target = 9,</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">   Because nums[0] + nums[1] = 2 + 7 = 9,</span></span><br><span class="line"><span class="string">   return [0, 1].</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>常规解法是双循环，时间开销是O(n)。通过构建哈希表可以将其降低到O(1)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">    <span class="comment">//1.构建哈希表</span></span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        map.put(nums[i], i);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//2.在哈希表中查找差值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> complement = target - nums[i];</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(complement) &amp;&amp; map.get(complement) != i) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; i, map.get(complement) &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"No two sum solution"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个解法利用了哈希表的高效查找。值得注意的是这里所构建哈希表的元素是<strong>(值，索引)</strong>,因为索引不可能相同，而值可能相同，所以数组中的相同元素在插入时，会被覆盖。</p>
<p>例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] nums = &#123;<span class="number">3</span>, <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure>
<p> 获得的 map 将是 { 3:1 }, 而不是{ 3:1, 3:0 } 。这样就存在一个隐患，所幸的是我们构建哈希表时被覆盖的是索引小的那个，查找时是根据索引小的那个查找索引大的那个，而且这个题目只要求查找出一对数就够了。</p>
<p>我们可以进一步思考下这个算法的关键步骤在哪里？</p>
<p>是<strong>利用哈希表判断差值是否在表中存在</strong>的那一步，这一步本来都要起一个循环来判断的，因为我们构建并利用了哈希表，所以开销从O(n)降低到了O(1)，但是正因为如此，<strong>哈希表的 key 值必须用数字值而不是索引值</strong>，随之而来的就是<strong>重复数字值在哈希表中被覆盖问题</strong>，这导致了我们无法用这种方法求出所有满足条件的结果。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/17/天文/历法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/17/天文/历法/" class="post-title-link" itemprop="url">历法</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-17 17:30:30 / 修改时间：19:46:39" itemprop="dateCreated datePublished" datetime="2019-09-17T17:30:30+08:00">2019-09-17</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/天文/" itemprop="url" rel="index"><span itemprop="name">天文</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>4.2k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>4 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="历法"><a href="#历法" class="headerlink" title="历法"></a>历法</h1><p>历法是根据天象(主要是日月)规律，计算时间(即年月日长度)，以判断季节变化的法则。</p>
<h3 id="历法的中心问题：年和月"><a href="#历法的中心问题：年和月" class="headerlink" title="历法的中心问题：年和月"></a>历法的中心问题：年和月</h3><p>制定历法所凭借的依据不外乎太阳和月亮的运动规律。<strong>日</strong>是最容易观测的确定一个时间间隔，凡经历过一个日升月落即为一日。这似乎是确定无疑的，但要为一日确定一个起点，却又并不容易。古人逐渐发现可以通过直立杆的投影来解决这一问题，将一天之内投影最短的时刻定为正午，这样两个正午之间的时刻就是一日。</p>
<p>连续观测正午时刻直立杆的投影长度，就能够发现它是周期循环，这一循环的发现导致<strong>“年”</strong>的产生。此外还导致最初两个节气的产生：人们将投影长度最短的那一天叫做一年的<strong>夏至</strong>，最长的那一天叫做一年的<strong>冬至</strong>。</p>
<p>对投影的观测实际是间接观测太阳，与之相比，月相的观测更加简单直接。月亮的盈亏也是一种周期循环，这导致<strong>“月”</strong>的产生。</p>
<p>现在我们知道，太阳直射点的变化周期，即一个回归年为365.2421897日，月亮绕地球运行的周期，即朔望月，大约29.530588日。二者都不是整数，且不能整除，使得一个回归年不能平摊成整数个朔望月。这导致太阴历法和太阳历法都有一定的缺陷。</p>
<h3 id="太阳历和太阴历的缺陷"><a href="#太阳历和太阴历的缺陷" class="headerlink" title="太阳历和太阴历的缺陷"></a>太阳历和太阴历的缺陷</h3><p>就太阴历而言，它以月相周期定月，12个朔望月为一年，这样一年约354或355日，这样每年会短缺11日左右。只要16个阴历年左右，就会差距到180多天，即半年左右，就会发生6月下雪、腊月天旱、冬夏倒置的毛病，对农业生产没有指导意义。太阴历的这种弊端之由来在于完全忽视了回归年，而回归年又是四季的依据。在文明开始之初，因为月亮便于观测，太阴历曾被广泛采用，但随着使用过程中的问题暴漏，逐渐被放弃。</p>
<p>就太阳历而言，它以回归周期定年，不依据月相，分一年为12个月，有大小月之分，<strong>这个“月”和朔望月完全无关</strong>。太阳历比太阴历问题少，它符合四季规律，但是月相的变化与月完全不能合拍。此外对于古人而言，回归年并不是整数日，这意味着随着年的累计，太阴历上的问题也会到来，只不过速度比较慢而已。</p>
<p>古埃及因为尼罗河泛滥的原因，非常重视天文学和历法的制定。他们在7千年前，已经把回归年定为365天。然而这个时间与真实的回归年相差0.24天，这意味着每100个回归年之后，历法上便少计24天，大约700多年后，就会出现与太阴历相同的冬夏颠倒的情况。这一情形需要再过700多年才能纠正。循环周期长达1461年。</p>
<h3 id="连分数与闰年"><a href="#连分数与闰年" class="headerlink" title="连分数与闰年"></a>连分数与闰年</h3><p>连分数的意义在于把实数(如5.0989)变成<strong>纯粹的数学形式</strong>。与小数表示形式相比，连分数可以进行<strong>截断逼近</strong>。例如</p>
<script type="math/tex; mode=display">
\pi = 3 + \frac{1}{7+\frac{1}{15+\frac{1}{\frac{1}{1+\frac{1}{292+\dots}}}}} \approx \frac{3}{1}\approx \frac{22}{7}\approx \frac{333}{105}</script><p>把回归年数写成连分数形式</p>
<script type="math/tex; mode=display">
.2421897 = \frac{10463}{43200} = \frac{1}{4+\frac{1}{7+\frac{1}{1+\frac{1}{3+\frac{1}{5+\frac{1}{64}}}}}} \approx \frac{1}{4}, \frac{1}{4+\frac{1}{7}}=\frac{7}{29}, \frac{1}{4+\frac{1}{7+\frac{1}{1}}}=\frac{8}{33}</script><p>这里是前三次逼近结果，由此我们可以知道<strong>如何通过置闰的方式解决回归年周期问题</strong>。回归年取近似值$\frac{1}{4}$ 意味着每 4 年太阳历会比回归年少 1 天，因此要每4年置闰一天。这是第一步的近似。更精确的近似是$\frac{7}{29}$ ，即每 29 年太阳历会比回归年少 7 天，因此经过 29 个太阳历年后需要外加上 7 天之后才能开始下一回归年。对于第三个分数，就是每 33 年后需要加 8 天，也等于 99 年加 24 天。</p>
<p>如果取第一级截断近似，就是每 4 年一个闰年，闰年里将 2 月变为 29 日来增加一天。这个数值略大于回归年，会产生每年 0.008 天的差距，这样100年近似于1天，大约2万2千年之后进入冬夏颠倒的混乱期。这个误差人们还是不能忍受，于是要每过一百年减去 1 天来进行补偿，即<strong>百年不设闰</strong>。这样每年的差距实际只有 0.0002 天的差距，混乱周期扩大到百万年级别，可以认为是非常精确了。</p>
<p>这里还有最后一个问题：近似是 99 年加 24 天，实际采用百年不设闰，二者是有差别的。每隔 400 年，添加了天数为 24 <em> 4 天，这样差距为 0.002 天，仍然很大。所以设置<em>*每 400 年置闰</em></em>，差距变为 0.00031 天，接近 $\frac{8}{33}$ 的效果。</p>
<h3 id="农历闰月"><a href="#农历闰月" class="headerlink" title="农历闰月"></a>农历闰月</h3><p><strong>农历是一种阴阳历，年采用回归年，月采用朔望月</strong>，因此需要安排闰月来调整。公历则无此需要，因此公历的月不会与月相变化相吻合。</p>
<p>在一个回归年年，每年的月数是 12.36826, 写成连分数为</p>
<script type="math/tex; mode=display">
\frac{365.2422}{29.5306} = 12+\frac{108750}{295306} 
= \frac{1}{2+\frac{1}{1+\frac{1}{2+\frac{1}{2+\frac{1}{1+\frac{1}{3}}}}}} \approx \frac{1}{2}, \frac{1}{2+\frac{1}{1}}=\frac{3}{8}, \frac{1}{2+\frac{1}{1+\frac{1}{2+\frac{1}{2}}}}=\frac{7}{19}</script><p>这里 $\frac{7}{19} = 0.36842$ 已经非常接近，每年会产生 0.00016 个月的差距。此即 <strong>19年7闰</strong>。</p>
<h3 id="历史上的历法"><a href="#历史上的历法" class="headerlink" title="历史上的历法"></a>历史上的历法</h3><p>公元前45年罗马皇帝儒略·凯撒在埃及天文学家协助下创立的儒略历，设置四年一闰。从前面的描述我们知道儒略历并不非常精确，4个回归年的零数积累在一起，为23时15分4秒，还不足一日，尚差44分56秒。由于累积误差随着时间越来越大，根据前面的推算，到 1582年改历那天，<strong>儒略历在1600年里产生大约 10 天的误差</strong>。</p>
<p>1582年罗马教皇格里高利十三世制订格里高利历，也叫公历。“四年一闰”每400年就将相差三日。为此，每400年必须少闰三次。设置97个闰年。<strong>公历亦称阳历</strong>，与中国传统<strong>农历(阴阳历)</strong>不同。</p>
<p><strong>改历前后的历史事件和文件有造成混乱的可能。</strong></p>
<p>中国历史上一共产生过102部历法，如夏历、商历、周历、西汉太初历、隋唐大衍历和皇极历等。汉代之前的历法就采用阴阳历，即“古六历”（黄帝、颛顼、夏、殷、周、鲁）中的《颛顼历》，以365又1/4日为一回归年，以29又499/940日为一朔望月， 19年中置7个闰月。由于这种古历计算不够精密，常出现月初朔日，但实际天空中却有圆满的月光；月中望日，夜晚却并没有月亮。为了改变这种不对照的现象， 司马迁主持制订《太初历》。</p>
<p>汉朝初年沿用秦朝的历法颛顼历，以农历的十月为一年之始，因历法与天象运行正朔失合，司马迁在公元前104年（汉武帝元封七年）上书，“言历纪坏废，宜改正朔”。汉武帝“乃诏迁用邓平所造八十一分律历，罢尤疏远者十七家”。并将元封七年改为太初元年。</p>
<p>《<strong>太初历</strong>》测算出一朔望月等于29又81分之43日，故又称为“81分律历”。以冬至所在之月为11月，改秦历以10月为岁首的错误，<strong>以正月为岁首，12月底为岁末</strong>，并首次将24节气订入该历法，与春种、秋收、夏忙、冬闲的农业节奏合拍，春生夏长，秋收冬藏，四季顺昌。落下闳在预见《太初历》不足之处曾指出：“日后八百岁，此历差一日，当有圣人定之。”（实际上仅一百余年即误差一日）。<strong>落下闳</strong>计算《太初历》即采用前述“<strong>连分数</strong>”的数学原理。</p>
<h4 id="正朔"><a href="#正朔" class="headerlink" title="正朔"></a>正朔</h4><p>正朔是历法定年定月之基础。<strong>正者，岁之始也，朔者，月之始也。</strong>一年的第一个月称作<strong>正月</strong>，一月的第一日称作<strong>朔日</strong>。上古之时，计算历法与授时被认为是与上天沟通的重要形式，只有部落领袖和统治者才有权进行。甚至于直到清代，私习天文都被认为是有谋反之意。改年号与颁历法仍然是皇帝体现权力的重要手段。旧时历书称为皇历，盖因历书必由皇帝所颁。</p>
<p>因为正朔是天子权力象征，所以在王朝更迭之际，奉何正朔也同时表明了政治取向。例如，孔子在《春秋》中，每年之初必称“某年春王正月”，《公羊传》：“春者何？岁之始也。王者孰谓？谓文王也。曷为先言王而后言正月？王正月也。何言乎王正月？大一统也。”也就是说，鲁尊周文王所定之正朔，以示鲁忠于周。而因鲁桓公弑君而立，桓公三年至八年，及十一年至十七年，《春秋》只称“某年春正月”，曰桓无王也。</p>
<p>秦历十月开始一年, 自汉武帝正式使用年号，颁布太初历，改用夏正以后，后世两千多年的帝王一般只改年号而不改正朔，只有武则天，太平天国等改正朔。很多文献都称，今日所用之华夏历法就是夏历，但现行华夏历法已有演变，事实上今日之历法只是沿用了夏正，而没有用夏朔。夏以天明为朔，商以鸡鸣为朔，周以夜半为朔，体现了计时的进步；</p>
<h3 id="节气"><a href="#节气" class="headerlink" title="节气"></a>节气</h3><p>中国古代利用土圭实测日晷，将每年日影最长定为“日至”（又称日长至，即太极图中四象的太阴、长至、冬至），日影最短为“日短至”（又称短至、夏至）。在春秋两季各有一日的昼夜时间长短相等，便定为“春分”和“秋分”，人类各民族多有此四。在商朝时只有四个节气（四象，即四季），到了周朝时发展到了八个（八卦），到秦汉年间，二十四节气已完全确立。公元前104年，由邓平等制定的《太初历》，正式将二十四节气订于历法，明确了二十四节气的天文位置。</p>
<p>二十四节气每一个分别相应于太阳在黄道上每运动15°所到达之位置。二十四节气又分为12个节气和12个中气，一一相间。<strong>二十四节气反映了太阳周年视运动，所以其西历日期近乎固定</strong>，上半年的节气在6日，中气在21日，下半年的节气在8日，中气在23日，前后不差1～2日。二十四节气的命名反应了季节和气候的变化。立春、春分、立夏、夏至、立秋、秋分、立冬、冬至，又称八位，是区分公转运动对于地球影响的八个关键节点；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">春雨惊春清谷天；</span><br><span class="line">夏满芒夏暑相连；</span><br><span class="line">秋处露秋寒霜降；</span><br><span class="line">冬雪雪冬小大寒。</span><br><span class="line">每月两节不变更；</span><br><span class="line">最多相差一两天；</span><br><span class="line">上半年来六廿一； // 上半年的节气在6日，中气在21日</span><br><span class="line">下半年来八廿三。 // 下半年的节气在8日，中气在23日</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/17/工具/Typora/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/17/工具/Typora/" class="post-title-link" itemprop="url">Typora</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-17 12:08:41 / 修改时间：16:54:47" itemprop="dateCreated datePublished" datetime="2019-09-17T12:08:41+08:00">2019-09-17</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>8.5k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>8 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Typora 的使用其实都在 帮助 菜单里，本文是其中的一些总结， markdown 的基本语法不再提及。</p>
<h2 id="大纲视图"><a href="#大纲视图" class="headerlink" title="大纲视图"></a>大纲视图</h2><p>在视图菜单里可以调节各种视图。</p>
<img src="/2019/09/17/工具/Typora/outlineView.png">
<h2 id="一些符号"><a href="#一些符号" class="headerlink" title="一些符号"></a>一些符号</h2><h3 id="KBD"><a href="#KBD" class="headerlink" title="KBD"></a>KBD</h3><p><kbd>Command</kbd></p>
<p>效果</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span>Command<span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Task-List"><a href="#Task-List" class="headerlink" title="Task List"></a>Task List</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>[ ] incomplete</span><br><span class="line"><span class="bullet">- </span>[x] completed</span><br></pre></td></tr></table></figure>
<p>效果</p>
<ul>
<li>[ ] incomplete</li>
<li>[x] completed</li>
</ul>
<h3 id="Footnotes-脚注"><a href="#Footnotes-脚注" class="headerlink" title="Footnotes(脚注)"></a>Footnotes(脚注)</h3><p><strong>脚注</strong>，有<strong>悬停标注</strong>的特性，适合于解释某些名词，例如</p>
<blockquote>
<p>相对论是爱因斯坦<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>创立的。</p>
</blockquote>
<p>通过【段落】- 【脚注】操作</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">相对论是爱因斯坦<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>创立的。</span><br><span class="line"></span><br><span class="line">[<span class="symbol">^1</span>]: <span class="link">德国物理学家，诺贝尔奖获得者。</span></span><br></pre></td></tr></table></figure>
<h3 id="高亮"><a href="#高亮" class="headerlink" title="高亮"></a>高亮</h3><p>文本高亮首先要在 【文件 - 偏好配置】，打开 【扩展语法 - 高亮】，而后</p>
<blockquote>
<p>==高亮文本==  </p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">==高亮文本==</span><br></pre></td></tr></table></figure>
<h2 id="HTML-元素"><a href="#HTML-元素" class="headerlink" title="HTML 元素"></a>HTML 元素</h2><p>以上还只是在 Typora 给定范围内的功能，实际上 <strong>Typora 本身是个能解析 Html 的“浏览器”</strong>，这个软件界面包括菜单项都是 Html 元素，使用者所编写的 markdown 语句最终也被解析成了 html 元素而已。</p>
<p>我们打开【视图-开发者模式】就会看到类似于 chrome 开发者模式的控制台，</p>
<img src="/2019/09/17/工具/Typora/typoraconsole.png" title="控制台">
<p>可见标题 【Block Elements】是以 h2 和 span 标签的形式嵌入到 html 文档中的。</p>
<p>利用这一点，我们可以直接插入 Html ，并利用 CSS 属性改变样式。</p>
<p>例如我们借助 video 标签插入一段视频<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">"..\img\got.mp4"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><video src="got.mp4" controls="controls">The <code>&lt;video&gt;</code> tag is not supported by your browser.</video><br>Bilibili上的视频直接可以得到嵌入代码，非常容易插入，例如</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">height</span>=<span class="string">"600"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">src</span>=<span class="string">"//player.bilibili.com/player.html?aid=48521546&amp;cid=84967122&amp;page=1"</span> <span class="attr">allowfullscreen</span>=<span class="string">"true"</span> &gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><iframe height="600" width="100%" src="//player.bilibili.com/player.html?aid=48521546&cid=84967122&page=1" allowfullscreen="true"> </iframe><br>再例如我们要插入一段蓝色文本，可以采用<strong>内联样式</strong></p>
<div align="center">
    国际米兰的颜色是<span style="color:blue"><b>蓝色</b></span>和黑色。
</div>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>国际米兰的颜色是<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:blue"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>蓝色<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>和黑色。<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为我们无法操作 head 标签，所以无法采用内部样式表和外部样式表的方式来改变样式。</p>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p>插入图片可以直接拖拽，也可以使用【编辑-图片工具-插入本地图片】操作。生成的 markdown 语法如下</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">outlineView</span>](<span class="link">..\img\outlineView.png</span>)</span><br></pre></td></tr></table></figure>
<p>如果要改变图片的显示方式，就不能采用这种方式了。应该直接使用 img 标签，这样可以通过修改样式来改变图片的大小和对齐方式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://img.mp.itc.cn/upload/20170105/d05be7e27f414afc90940ef7da148ddd_th.jpg"</span> <span class="attr">alt</span>=<span class="string">"改变图片大小和对齐"</span>  <span class="attr">style</span>=<span class="string">"margin:3px;border:2px solid #be5abe;width:600px;height:300px; "</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<div align="center">
    <img src="http://img.mp.itc.cn/upload/20170105/d05be7e27f414afc90940ef7da148ddd_th.jpg" alt="改变图片大小和对齐" style="margin:3px;border:2px solid #be5abe;width:600px;height:300px; "></div>



<p>这里为了实现对齐，添加了一个 div 元素。也可以采用简化操作</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://img.mp.itc.cn/upload/20170105/d05be7e27f414afc90940ef7da148ddd_th.jpg"</span> <span class="attr">alt</span>=<span class="string">"改变图片大小和对齐"</span>  <span class="attr">style</span>=<span class="string">"zoom:50% "</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center>
    <img src="http://img.mp.itc.cn/upload/20170105/d05be7e27f414afc90940ef7da148ddd_th.jpg" alt="改变图片大小和对齐" style="zoom:50% "></center>

<blockquote>
<p>在插入图片的时候，选择【编辑-图片工具- 图片设置】，选择将图片复制到指定文件夹，可以<strong>保存图片</strong>。</p>
</blockquote>
<h2 id="主题和CSS"><a href="#主题和CSS" class="headerlink" title="主题和CSS"></a>主题和CSS</h2><p>打开【文件 - 偏好设置 - 主题文件夹】可以发现主题 CSS 文档，通过修改参数可以定制主题。</p>
<p>Typora 使用 CSS 文档的顺序如下：</p>
<ol>
<li>Typora’s basic styles.</li>
<li>CSS for current theme.</li>
<li><code>base.user.css</code> under theme folder.</li>
<li><code>{current-theme}.user.css</code> under theme folder.  eg:<code>github.user.css</code></li>
</ol>
<p>在主题文件夹中创建 base.user.css 和 {current-theme}.user.css 即可以实现改变样式属性的目的。例如在 github.user.css 文件中写入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">	<span class="attribute">color</span>: <span class="number">#f484c1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即可以改变所有 span 标签的文本颜色。但是这种方法<strong>无法使用 id 和 class 选择器</strong>。</p>
<h3 id="文字从右向左"><a href="#文字从右向左" class="headerlink" title="文字从右向左"></a>文字从右向左</h3><p>添加以下 CSS 代码即可。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#write</span> &#123;</span><br><span class="line">	<span class="attribute">direction</span>: rtl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下</p>
<blockquote>
<p>​                                                                                                                            文字从右向左</p>
</blockquote>
<p>这个效果虽然简单，其中使用的 id 选择器却值得注意， 翻阅源码可以发现，<strong>整个内容文本都被放置在 id 为 “write” 的 div 块元素中 。</strong>这段 CSS 代码就是针对内容区所有对象进行设置。</p>
<p>另外，如果我们自己添加元素，并设置 id 或者 class，如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"jack"</span>&gt;</span>好看撒大撒大撒啊<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个 P 元素会被套在若干个 div 块里，<strong>所设置 id 和 class 属性都不会保留</strong>, 其它属性如 style 则可以保留并发挥作用。</p>
<h3 id="背景图片"><a href="#背景图片" class="headerlink" title="背景图片"></a>背景图片</h3><p>背景虽然不实用，但如果要设置，首先还是要寻找合适的纹理文件</p>
<p><a href="http://www.fuzzimo.com/free-seamless-textures-notebook-papers/#comments" target="_blank" rel="noopener">纹理文件下载</a></p>
<p>[纹理文件下载]: </p>
<p>下载拷贝到主题文件夹，添加 CSS 代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">content</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(./fzm-seamless.notebook.texture-06.jpg);</span><br><span class="line">  <span class="attribute">background-repeat</span>: repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h3><p>调节代码块的意义更大一些，先给个效果图</p>
<img src="/2019/09/17/工具/Typora/Snip20160623_11.png">
<p>添加如下 CSS 代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cm-s-inner</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#263238</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(233, 237, 237, 1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-gutters</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#263238</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(83,127,126);</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-guttermarker</span>, <span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-guttermarker-subtle</span>, <span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-linenumber</span> &#123; <span class="attribute">color</span>: <span class="built_in">rgb</span>(83,127,126); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-cursor</span> &#123; <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#f8f8f0</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-tag">div</span><span class="selector-class">.CodeMirror-selected</span> &#123; <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0.15); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span><span class="selector-class">.CodeMirror-focused</span> <span class="selector-tag">div</span><span class="selector-class">.CodeMirror-selected</span> &#123; <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0.10); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span><span class="selector-pseudo">::selection</span>, <span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span> &gt; <span class="selector-tag">span</span><span class="selector-pseudo">::selection</span>, <span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span> &gt; <span class="selector-tag">span</span> &gt; <span class="selector-tag">span</span><span class="selector-pseudo">::selection</span> &#123; <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0.10); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span><span class="selector-pseudo">::-moz-selection</span>, <span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span> &gt; <span class="selector-tag">span</span><span class="selector-pseudo">::-moz-selection</span>, <span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span> &gt; <span class="selector-tag">span</span> &gt; <span class="selector-tag">span</span><span class="selector-pseudo">::-moz-selection</span> &#123; <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0.10); &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-activeline-background</span> &#123; <span class="attribute">background</span>: <span class="built_in">rgba</span>(0, 0, 0, 0); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-keyword</span> &#123; <span class="attribute">color</span>: <span class="built_in">rgba</span>(199, 146, 234, 1); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-operator</span> &#123; <span class="attribute">color</span>: <span class="built_in">rgba</span>(233, 237, 237, 1); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable-2</span> &#123; <span class="attribute">color</span>: <span class="number">#80CBC4</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable-3</span> &#123; <span class="attribute">color</span>: <span class="number">#82B1FF</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-builtin</span> &#123; <span class="attribute">color</span>: <span class="number">#DECB6B</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-atom</span> &#123; <span class="attribute">color</span>: <span class="number">#F77669</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-number</span> &#123; <span class="attribute">color</span>: <span class="number">#F77669</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-def</span> &#123; <span class="attribute">color</span>: <span class="built_in">rgba</span>(233, 237, 237, 1); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-string</span> &#123; <span class="attribute">color</span>: <span class="number">#C3E88D</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-string-2</span> &#123; <span class="attribute">color</span>: <span class="number">#80CBC4</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-comment</span> &#123; <span class="attribute">color</span>: <span class="number">#546E7A</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable</span> &#123; <span class="attribute">color</span>: <span class="number">#82B1FF</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-tag</span> &#123; <span class="attribute">color</span>: <span class="number">#80CBC4</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-meta</span> &#123; <span class="attribute">color</span>: <span class="number">#80CBC4</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-attribute</span> &#123; <span class="attribute">color</span>: <span class="number">#FFCB6B</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-property</span> &#123; <span class="attribute">color</span>: <span class="number">#80CBAE</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-qualifier</span> &#123; <span class="attribute">color</span>: <span class="number">#DECB6B</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable-3</span> &#123; <span class="attribute">color</span>: <span class="number">#DECB6B</span>; &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-tag</span> &#123; <span class="attribute">color</span>: <span class="built_in">rgba</span>(255, 83, 112, 1); &#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-error</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(255, 255, 255, 1.0);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#EC5F67</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-matchingbracket</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">  <span class="attribute">color</span>: white <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**apply to code fences with plan text**/</span></span><br><span class="line"><span class="selector-class">.md-fences</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#263238</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(233, 237, 237, 1);</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-fences</span> <span class="selector-class">.code-tooltip</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#263238</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们写的代码块会被转化为一个复杂的 div 盒子，这个盒子的一个 class 属性就是 “cm-s-inner”，内部元素各有各的 class 命名，例如展示代码的行号的 div 盒子的 class 是 “CodeMirror-gutters”，因此这里给它设置的是一个二级匹配器。</p>
<h3 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h3><p>更改字体设置如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: DFKai-SB; <span class="comment">/** Microsoft Yahei UI **/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字体名称可以在 【C:\Windows\Fonts】目录下查看，也可以在 【设置-字体】中查找，例如微软雅黑的全名是 Microsoft Yahei UI。</p>
<p>下载新字体，例如徐静蕾字体，放入上述目录中即安装成功字体，此时查出此字体名称为 “方正静蕾字体”，即可以配置使用。</p>
<h3 id="宽度"><a href="#宽度" class="headerlink" title="宽度"></a>宽度</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#write</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">1800px</span>; <span class="comment">/*adjust writing area position*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打开 Tepora 是文本宽度将扩展到1800 px，可以调整打开时的视觉效果。</p>
<h3 id="标题编号"><a href="#标题编号" class="headerlink" title="标题编号"></a>标题编号</h3><p>添加如下 CSS 代码可以给各个标题自动生成编号，这个功能实际上并不怎么有用，但可以用来学习 CSS。 </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** initialize css counter */</span></span><br><span class="line"><span class="selector-id">#write</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h4</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h5</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h5</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h6</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** put counter result into headings */</span></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h1</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h1;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">". "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h2</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h2;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">". "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h3</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h3</span><span class="selector-class">.md-focus</span><span class="selector-class">.md-heading</span><span class="selector-pseudo">:before</span> <span class="comment">/** override the default style for focused headings */</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h3;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">". "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h4</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h4</span><span class="selector-class">.md-focus</span><span class="selector-class">.md-heading</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h4;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">". "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h5</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h5</span><span class="selector-class">.md-focus</span><span class="selector-class">.md-heading</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h5;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">"."</span> <span class="built_in">counter</span>(h5) <span class="string">". "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h6</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h6</span><span class="selector-class">.md-focus</span><span class="selector-class">.md-heading</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h6;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">"."</span> <span class="built_in">counter</span>(h5) <span class="string">"."</span> <span class="built_in">counter</span>(h6) <span class="string">". "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** override the default style for focused headings */</span></span><br><span class="line"><span class="selector-id">#write</span>&gt;<span class="selector-tag">h3</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-id">#write</span>&gt;<span class="selector-tag">h4</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-id">#write</span>&gt;<span class="selector-tag">h5</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-id">#write</span>&gt;<span class="selector-tag">h6</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h3</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h4</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h5</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h6</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: inherit;</span><br><span class="line">    <span class="attribute">border</span>: inherit;</span><br><span class="line">    <span class="attribute">border-radius</span>: inherit;</span><br><span class="line">    <span class="attribute">position</span>: inherit;</span><br><span class="line">    <span class="attribute">left</span>:initial;</span><br><span class="line">    <span class="attribute">float</span>: none;</span><br><span class="line">    <span class="attribute">top</span>:initial;</span><br><span class="line">    <span class="attribute">font-size</span>: inherit;</span><br><span class="line">    <span class="attribute">padding-left</span>: inherit;</span><br><span class="line">    <span class="attribute">padding-right</span>: inherit;</span><br><span class="line">    <span class="attribute">vertical-align</span>: inherit;</span><br><span class="line">    <span class="attribute">font-weight</span>: inherit;</span><br><span class="line">    <span class="attribute">line-height</span>: inherit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="右键搜索"><a href="#右键搜索" class="headerlink" title="右键搜索"></a>右键搜索</h2><p>选中文本后，可以右键选择 google 搜索，但是没有翻墙是无用的。在【文件 - 偏好设置 -高级设置】中打开 【文件 conf.user.json】，加入</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"searchService": [</span><br><span class="line">    [<span class="string">"Search with Google"</span>, <span class="string">"https://google.com/search?q=%s"</span>]</span><br><span class="line">	[<span class="string">"Search with baidu"</span>, <span class="string">"https://www.baidu.com/s?ie=UTF-8&amp;wd=%s"</span>]</span><br><span class="line">	[<span class="string">"Translate"</span>, <span class="string">"https://translate.google.cn/#view=home&amp;op=translate&amp;sl=auto&amp;tl=en&amp;text=%s"</span>]</span><br><span class="line">    [<span class="string">"Search with Wikipedia"</span>, <span class="string">"https://en.wikipedia.org/wiki/Special:Search/%s"</span>]</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>四个选项分别是 Google搜索，百度，百度翻译，英文Wiki。</p>
<h2 id="PanDoc"><a href="#PanDoc" class="headerlink" title="PanDoc"></a>PanDoc</h2><p>PanDoc 是一个标记语言的翻译器，例如能够将 Html 文本转换为 Wiki 文本。</p>
<p><a href="https://pandoc.org/getting-started.html" target="_blank" rel="noopener">PanDoc 使用方法</a></p>
<p>通过 PanDoc 比较重要的大概是我们可以直接将 md 文档转为 docx，pdf 等格式了，只要安装了 PanDoc 再使用 export 即可。</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">德国物理学家，诺贝尔奖获得者。</span><a href="#fnref:1" rev="footnote"> ↩</a></li></ol></div></div>
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/14/工具/Hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/14/工具/Hexo/" class="post-title-link" itemprop="url">Hexo Hello World</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-14 17:04:14" itemprop="dateCreated datePublished" datetime="2019-09-14T17:04:14+08:00">2019-09-14</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-19 20:04:24" itemprop="dateModified" datetime="2019-09-19T20:04:24+08:00">2019-09-19</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>1.4k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>1 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% asset_img slug [千与千寻的神隐] %&#125;</span><br></pre></td></tr></table></figure>
<img src="/2019/09/14/工具/Hexo/timg.jpg" title="[千与千寻的神隐]">
<h3 id="插入PDF"><a href="#插入PDF" class="headerlink" title="插入PDF"></a>插入PDF</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save hexo-pdf</span><br><span class="line">&#123;% pdf polar.pdf %&#125;</span><br></pre></td></tr></table></figure>
<div class="pdf" target="./polar.pdf" height></div>
<div class="pdf" target="http://7xov2f.com1.z0.glb.clouddn.com/bash_freshman.pdf" height></div>
<h3 id="插入音频"><a href="#插入音频" class="headerlink" title="插入音频"></a>插入音频</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">"11.mp3"</span> <span class="attr">controls</span>=<span class="string">"controls"</span> <span class="attr">autoplay</span>=<span class="string">"true"</span> <span class="attr">loop</span>=<span class="string">"true"</span>&gt;</span>新标日第11课<span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<div align="center">
<audio src="11.mp3" controls="controls" autoplay="true" loop="true">新标日第11课</audio>
</div>

<h3 id="插入视频"><a href="#插入视频" class="headerlink" title="插入视频"></a>插入视频</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">"got.mp4"</span> <span class="attr">controls</span>=<span class="string">"controls"</span>&gt;</span>冰与火之歌<span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><video src="got.mp4" controls="controls">冰与火之歌</video></p>
<h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<h3 id="html-synchronizer"><a href="#html-synchronizer" class="headerlink" title="html synchronizer"></a>html synchronizer</h3><p>fetch remote webpage(including image file) and save to hexo post.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-html-syncer --save</span><br><span class="line"><span class="comment"># for example:</span></span><br><span class="line">$ hexo syncer http://mp.weixin.qq.com/s/Tp4W-_0MXMvN5Tw3jlrtLg</span><br></pre></td></tr></table></figure>
<h3 id="auto-category"><a href="#auto-category" class="headerlink" title="auto-category"></a><strong>auto-category</strong></h3><p>Automatically add front-matter <code>categories</code> to Hexo article according to the article file directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-auto-category --save</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_category:</span><br><span class="line"> <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line"> depth:</span><br></pre></td></tr></table></figure>
<h3 id="豆瓣"><a href="#豆瓣" class="headerlink" title="豆瓣"></a>豆瓣</h3>
        <div id="aplayer-SNMvNJJO" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-SNMvNJJO"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Caffeine",
              author: "Jeff Williams",
              url: "11.mp3",
              pic: "/2019/09/14/工具/Hexo/timg.jpg",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/24/随笔/由西安奔驰车维权案所联想的/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/06/24/随笔/由西安奔驰车维权案所联想的/" class="post-title-link" itemprop="url">西安奔驰事件所思</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-06-24 09:48:29" itemprop="dateCreated datePublished" datetime="2019-06-24T09:48:29+08:00">2019-06-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-17 20:13:01" itemprop="dateModified" datetime="2019-09-17T20:13:01+08:00">2019-09-17</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>1.9k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>2 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> 从4s店女代表的发言可以看到，在闹出这么大动静之后，她依然是一副高高在上的态度，绝不认为己方有任何错误，所做的退让乃是施予客户的恩惠。</p>
<p>这个事出了之后，4s店内部有充足的时间准备，现在它们拿出这种态度来，说明它们对此事的处理原则就是抵赖推诿。由此可以想见它们一贯的行事原则，在坑蒙拐骗之余还问心无愧。</p>
<p>具体的事件自有相应的人和部门去善后，现在跳出具象谈谈一般的社会现象。</p>
<p>一切社会问题的本源就在公利和私欲上。作为社会的一份子，每个人追求私欲的本能是天生的和不择手段的，他维护公利的行为则是后天的和有所节制的，准确的说是在发现不维护公利不能保证自己的私欲的时候被动进行的。这样维护公利是作为追求私欲的前提存在，是一种无可奈何之举，因为人无此天性，公利又往往与私利相悖，欲使群体利益得到保障，必须要对个人施以教化。一般而言，受教育程度越高，越能明白公利之重要。按道理来讲，每个人都应该维护公利，然而这世界远非如此。</p>
<p>就商家消费者关系而言，整体消费者的利益是为公利，如果每一笔交易都能公平公正，全体消费者利益就能得到保证，因为此领域商家即为彼领域消费者，自然同受此惠。然而世间思来理所当然之事往往出人意表，付诸实施即谬以千里，何也？这是因为有这么一群人，并不承担公利义务，因而可以无节制追求私利，甚至以破坏公利为代价。<strong>求私欲而无视公利是一切社会问题的起源</strong>，不惟消费者市场如此。</p>
<p>现在的社会，一个人要想有尊严，有“排面”，那必须有钱，没钱则无“排面”。至于这钱是怎么来的，正义与否，合法与否，规则与否，并无人关心。于是我们看到蝇营狗苟之辈，各有稻粱之谋，所谓其不仁者富。反之一个人若是谨守良心，向不逾矩，则十有八九要忍饥挨饿，到那时他反而要受到奚落，他的讲道理受规矩反而在世俗中是一种羞辱。一个人即入了这种世道，他纵然有心向善，社会却必不叫他好看，他的落入不仁是可以预见的。</p>
<p>4s店女代表问”我们为什么要欺骗自己的上帝呢“，这话其实应该问她自己。所谓顾客是上帝只是一种营销话术，一般而言只有在你付款之前你才是上帝，如果售后也重视你，那只是还想做你下一笔生意罢了。这层遮羞布在中国尤其是一捅就破，顾客在此4s店眼里不惟不是上帝，亦或只是口头上帝，实际却是待宰肥羊。只要进了他这个门，就要掉一层皮。你不多出钱，它们卖车的，奔驰官方，搞金融放贷款的，甚至工商联等政府部门怎么有额外收入，怎么有业绩，又怎么有”排面“呢？</p>
<p>在社会的各种位置上，到处充斥着这种消费主义价值观所塑造的坑蒙拐骗之徒，阳奉阴违，笑里藏刀。而且我们知道，人在长时间尺度上终归是要归于自洽的，他纵犯有滔天罪恶，经过时间的熨烫，最终也能以理直气壮的面目出现。旧时的土匪不也管自己打家劫舍叫做吃这碗饭吗？吃饭是天经地义之举，自然打劫也就有理有据了。今日的4s店销售坑骗的人多了，自然早就从心理上开脱了自己。她既然没错，那错的必然是被她坑骗的顾客了。要问这些花了冤枉钱的顾客错在哪里？错就错在其它人被坑了都不闹事，偏偏就你闹事。<strong>这就是人的异化</strong>。这一点在今日的资本家群体身上尤其明显，经过反复的拉锯和试探，资本家已经不认为996是违反劳动合同法之举，而是他施予的福报。不接受996就是没有拼搏精神，把一件他自己无理之事变成劳动者的罪过。</p>
<p>对此情形，政府存在不可推卸的责任。人性本恶，因此法家主张严刑峻法以绝人之恶，以赏罚二柄塑造人的行为，使其导入农战二事。今天的政府几无作为。消费者和劳动者权益保护的远远不够，劳动合同法形同虚设，315做成了一门生意，资本家可以随意做伪证不受处罚，因此像顺丰这种无良公司可以随意践踏劳动合同。如果政府真的有心维护消费者劳动者权益，只要加大对此类行为的处罚力度，实施惩罚性罚款等，这些大大小小的骗子们自然趋利之余要兼顾避害，不敢如今日之肆无忌惮。</p>
<p>从政府对房价的调控来看，他们实际是不愿意真的降低房价，反应在行为上就是拖延，逼不得已出招时也是怪招频出，转走偏门，不抓实质，最后自然也不能真的把房价调控下来。在消费者劳动者权益问题上亦然，我相信中央政府层面还是有此理想的，但地方政府则利益牵涉太深，保护劳动者消费者权益就要背上一个破坏营商环境的罪名，而原本的税源就有影响，即使不考虑背后的利益输送，也有害于官员的业绩指标。因此它们本质上是即无心又无力，做起事来荒腔走板，不出事故不干事，息事宁人之后依然故我，指望他们是不切实际的。</p>
<p>虽然前景是悲观的，但不代表这种私欲侵害公利的现象就会永远持续下去。公利本是维护公众利益的，侵之愈急，后报越大，亿万兆民，概莫能免。比如消费主义越盛行，贫富分化越严重，女性要求的彩礼越高，底层的生育权利越萎缩，新的韭菜阶层不敷收割之用，未来的中国将无法避免走上引入移民之路，用夷变夏，绝非虚言。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/06/android/View/字体增强/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2017/09/06/android/View/字体增强/" class="post-title-link" itemprop="url">字体增强</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2017-09-06 21:26:26" itemprop="dateCreated datePublished" datetime="2017-09-06T21:26:26+08:00">2017-09-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-18 15:41:27" itemprop="dateModified" datetime="2019-09-18T15:41:27+08:00">2019-09-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/View/" itemprop="url" rel="index"><span itemprop="name">View</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>10k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>9 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>android 中使用字体是非常不方便的，因为不支持 xml 定义，必须使用代码来动态修改字体，也无法用样式或主题来批量修改字体。</p>
<p>现在我们来探索下面两个字体使用增强库的原理。</p>
<h2 id="android-typeface-helper"><a href="#android-typeface-helper" class="headerlink" title="android-typeface-helper"></a><a href="https://github.com/norbsoft/android-typeface-helper" target="_blank" rel="noopener">android-typeface-helper</a></h2><p>android-typeface-helper 是较为简单，使用方法如下</p>
<p>1.首先在 Application 中初始化，主要是创建和缓存字体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onCreate();</span><br><span class="line">	<span class="comment">// Initialize typeface helper</span></span><br><span class="line">	TypefaceCollection typeface = <span class="keyword">new</span> TypefaceCollection.Builder()</span><br><span class="line">	        .set(Typeface.NORMAL, Typeface.createFromAsset(getAssets(), <span class="string">"fonts/ubuntu/Ubuntu-R.ttf"</span>))</span><br><span class="line">	        .create();</span><br><span class="line">	TypefaceHelper.init(typeface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.对 Activity , ViewGroup 或 View 应用字体。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">	setContentView(R.layout.activity_layout);</span><br><span class="line">	TypefaceHelper.typeface(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以动态的改变字体。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">typeface</span><span class="params">(View view)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这个库是实际没有做太多事，仅仅对常规字体使用方法的包装而已。typeface 方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">applyForView</span><span class="params">(View view, TypefaceCollection typefaceCollection)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (view <span class="keyword">instanceof</span> TextView) &#123;</span><br><span class="line">      TextView textView = (TextView) view;</span><br><span class="line">      Typeface oldTypeface = textView.getTypeface();</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> style = oldTypeface == <span class="keyword">null</span> ? Typeface.NORMAL : oldTypeface.getStyle();</span><br><span class="line">      textView.setTypeface(typefaceCollection.getTypeface(style));</span><br><span class="line">      textView.setPaintFlags(textView.getPaintFlags() | Paint.SUBPIXEL_TEXT_FLAG);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见字体的更改只应用在 TextView 控件上，对于 ViewGroup 要执行递归更改，对于 Acitivity 实际是对 content 布局执行递归更改。</p>
<p>值得一提的是你还可以创造某种字体的 SpannableString</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SpannableString <span class="title">typeface</span><span class="params">(CharSequence sequence, TypefaceCollection typefaceCollection)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这是通过定义字体 span 获得的效果，不过首先通过集合提供字体对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TypefaceSpan</span> <span class="keyword">extends</span> <span class="title">MetricAffectingSpan</span> </span>&#123;</span><br><span class="line">   Typeface typeface;</span><br><span class="line">  </span><br><span class="line">   <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDrawState</span><span class="params">(TextPaint tp)</span> </span>&#123;</span><br><span class="line">      tp.setTypeface(typeface);</span><br><span class="line">      tp.setFlags(tp.getFlags() | Paint.SUBPIXEL_TEXT_FLAG);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Calligraphy"><a href="#Calligraphy" class="headerlink" title="Calligraphy"></a><a href="https://github.com/chrisjenx/Calligraphy" target="_blank" rel="noopener">Calligraphy</a></h2><p>使用 Calligraphy 这个库，你可以直接在 XML 文件中定义字体</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">fontPath</span>=<span class="string">"fonts/MyFont.ttf"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"TextAppearance.FontPath"</span> <span class="attr">parent</span>=<span class="string">"android:TextAppearance"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"fontPath"</span>&gt;</span>fonts/RobotoCondensed-Regular.ttf<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>自定义控件时添加一个属性并不稀奇，稀奇的是给系统控件 TextView 添加了一个属性 fontPath，而且生效了。</strong></p>
<p>要做到这点，首先要在 Application 中进行设置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    CalligraphyConfig.initDefault(<span class="keyword">new</span> CalligraphyConfig.Builder()</span><br><span class="line">                            .setDefaultFontPath(<span class="string">"fonts/Roboto-RobotoRegular.ttf"</span>)</span><br><span class="line">                            .setFontAttrId(R.attr.fontPath)</span><br><span class="line">                            .build()</span><br><span class="line">            );</span><br></pre></td></tr></table></figure>
<p>此外还需要在 Activity 中替换 Context</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context newBase)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.attachBaseContext(CalligraphyContextWrapper.wrap(newBase));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然该库也提供了 CalligraphyTypefaceSpan 供使用，不再叙述。</p>
<h3 id="LayoutInflater的原理解析"><a href="#LayoutInflater的原理解析" class="headerlink" title="LayoutInflater的原理解析"></a>LayoutInflater的原理解析</h3><p>android 是怎样解析属性的呢？核心是更改 LayoutInflater，该类的加载过程如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">inflate</span><span class="params">(@LayoutRes <span class="keyword">int</span> resource, ViewGroup root, <span class="keyword">boolean</span> attachToRoot)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Resources res = getContext().getResources();</span><br><span class="line">    <span class="keyword">final</span> XmlResourceParser parser = res.getLayout(resource); </span><br><span class="line">    AttributeSet attrs = Xml.asAttributeSet(parser);</span><br><span class="line">  </span><br><span class="line">    View result = root;</span><br><span class="line">    View temp = createViewFromTag(root, name, inflaterContext, attrs);</span><br><span class="line">    ViewGroup.LayoutParams params = root.generateLayoutParams(attrs);</span><br><span class="line">    <span class="keyword">if</span> (!attachToRoot) &#123;</span><br><span class="line">      temp.setLayoutParams(params);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (root != <span class="keyword">null</span> &amp;&amp; attachToRoot) &#123;</span><br><span class="line">        root.addView(temp, params);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span> || !attachToRoot) &#123;</span><br><span class="line">        result = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个过程实际是从布局文件中解析出 View 对象，再讲其添加到容器上去的过程。过程中有以下几点值得注意</p>
<p>1.attachToRoot 参数决定了是要要将View添加到容器上，以及返回值是容器自身还是View对象。</p>
<p>2.根据XML解析器生成View对象即 createViewFromTag 方法是一个移花接玉的过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">View <span class="title">createViewFromTag</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span></span>&#123;</span><br><span class="line">  TypedArray ta = context.obtainStyledAttributes(attrs, ATTRS_THEME);</span><br><span class="line">  <span class="keyword">int</span> themeResId = ta.getResourceId(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  context = <span class="keyword">new</span> ContextThemeWrapper(context, themeResId);</span><br><span class="line">  </span><br><span class="line">  View view;</span><br><span class="line">  <span class="keyword">if</span> (mFactory2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">      view = mFactory2.onCreateView(parent, name, context, attrs);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">      view = mFactory.onCreateView(name, context, attrs);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      view = <span class="keyword">null</span>;</span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">if</span> (view == <span class="keyword">null</span> &amp;&amp; mPrivateFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">      view = mPrivateFactory.onCreateView(parent, name, context, attrs);</span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">final</span> Object lastContext = mConstructorArgs[<span class="number">0</span>];</span><br><span class="line">      mConstructorArgs[<span class="number">0</span>] = context;</span><br><span class="line">      <span class="keyword">if</span> (-<span class="number">1</span> == name.indexOf(<span class="string">'.'</span>)) &#123;</span><br><span class="line">          view = onCreateView(parent, name, attrs); <span class="comment">//使用反射创建</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          view = createView(name, <span class="keyword">null</span>, attrs);     <span class="comment">//使用反射创建</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里创建View的处理顺序是 Factory2，Factory1，PrivateFactory，最后才是使用反射来创建。</p>
<p>我们知道通过 Factory2 可以改变View的创建过程，实际上 Activity 就是这样做的，在执行 <code>super.onCreate(savedInstanceState);</code>这一句时就设置了 PrivateFactory。</p>
<h3 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h3><p>我们通过自定义一个 LayoutInflater 来实现简单的效果，首先定义一个属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"customFont"</span> <span class="attr">format</span>=<span class="string">"string"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在xml中使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">customFont</span>=<span class="string">"fonts/Rotobo-Bold.ttf"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>这时该属性已经能够被 LayoutInflater 解析到 AttributeSet 参数中去。我们可以使用 Factory2 接口来观察这一现象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Factory2 只能设置一次，所以先用反射修改 mFactorySet 的值，以解除此限制</span></span><br><span class="line">LayoutInflater inflater = LayoutInflater.from(<span class="keyword">this</span>);</span><br><span class="line">Class cls = LayoutInflater.class;</span><br><span class="line">Field bool = cls.getDeclaredField(<span class="string">"mFactorySet"</span>);</span><br><span class="line">bool.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">bool.setBoolean(inflater, <span class="keyword">false</span>);</span><br><span class="line">inflater.setFactory2(<span class="keyword">new</span> LayoutInflater.Factory2() &#123;</span><br><span class="line">      </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(name.equals(<span class="string">"TextView"</span>)) &#123;</span><br><span class="line">           <span class="keyword">int</span> count = attrs.getAttributeCount();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                Log.i(TAG, attrs.getAttributeName(i)); <span class="comment">//customFont</span></span><br><span class="line">                Log.i(TAG, attrs.getAttributeValue(i));<span class="comment">//fonts/Rotobo-Bold.ttf</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>从这里就可以拿到资源值(即字体文件路径)了，利用这一属性就可以设置字体了，简易实现如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(name.equals(<span class="string">"TextView"</span>)) &#123;</span><br><span class="line">             TextView textview = <span class="keyword">new</span> TextView(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">             textview.setLayoutParams(<span class="keyword">new</span> ViewGroup.LayoutParams(<span class="number">400</span>, <span class="number">100</span>));</span><br><span class="line">             textview.setText(<span class="string">"中华大道 English hello 123456"</span>);</span><br><span class="line">             <span class="keyword">int</span> count = attrs.getAttributeCount();</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                 <span class="keyword">if</span>(attrs.getAttributeName(i).equals(<span class="string">"customfont"</span>))&#123;</span><br><span class="line">                      String path = attrs.getAttributeValue(i);</span><br><span class="line">                      Typeface typeface = Typeface.createFromAsset(getAssets(), path);</span><br><span class="line">                      textview.setTypeface(typeface);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> textview;</span><br><span class="line">         &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个简单的实现已经能通过自定义属性来修改字体文件了，但离具体应用还差的比较远，比如它无法使用 style 和主题，也会屏蔽掉其它View的生成，此外还默认设置成默认应用在 Activity 上。</p>
<h3 id="在Activity中应用字体属性"><a href="#在Activity中应用字体属性" class="headerlink" title="在Activity中应用字体属性"></a>在Activity中应用字体属性</h3><p>在Activity中应用字体属性就是要修改其中的LayoutInflater类，通过调查我们可以发现该类已经实现了 Factory2 接口，只要通过代理的方式来改造该接口的实现使其能够处理字体属性就行了。</p>
<p>实际过程分为两步</p>
<p>1.替换 Factory2 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> LayoutInflater <span class="title">getLayoutInflater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   LayoutInflater inflater = <span class="keyword">super</span>.getLayoutInflater();</span><br><span class="line">   <span class="keyword">final</span> LayoutInflater.Factory2 factory2 = inflater.getFactory2();</span><br><span class="line">    Class cls = LayoutInflater.class;</span><br><span class="line">    Field bool = cls.getDeclaredField(<span class="string">"mFactorySet"</span>);</span><br><span class="line">    bool.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    bool.setBoolean(inflater, <span class="keyword">false</span>);</span><br><span class="line">    inflater.setFactory2(<span class="keyword">new</span> WrapFacory2(factory2));</span><br><span class="line">    <span class="keyword">return</span> inflater;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意一定要做如下设置,在活动创建时就替换 LayoutInflater 来</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    getLayoutInflater(); <span class="comment">//改造已经存在的 LayoutInflater 对象</span></span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>LayoutInflater 对象在 Window 中，必须要调用 getLayoutInflater 来改造它，才能在活动中生效。</p>
</blockquote>
<p>2.利用代理扩展Factory2的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapFactory2</span> <span class="keyword">implements</span> <span class="title">LayoutInflater</span>.<span class="title">Factory2</span> </span>&#123;</span><br><span class="line">    LayoutInflater.Factory2 factory2;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapFactory2</span><span class="params">(LayoutInflater.Factory2 factory2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory2 = factory2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        View view = factory2.onCreateView(parent, name, context, attrs);</span><br><span class="line">        <span class="keyword">if</span>(view <span class="keyword">instanceof</span> TextView)&#123; <span class="comment">//支持所有 TextView 的子类，如Button</span></span><br><span class="line">            <span class="keyword">int</span> count = attrs.getAttributeCount();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(attrs.getAttributeName(i).equals(<span class="string">"customfont"</span>))&#123;</span><br><span class="line">                    String path = attrs.getAttributeValue(i);</span><br><span class="line">                    Typeface typeface = Typeface.createFromAsset(getAssets(), path);</span><br><span class="line">                    ((TextView)view).setTypeface(typeface);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>这样字体属性在这个 Activity 中就可以生效了，而且完全不干扰其它控件和其它属性。</strong></p>
<h3 id="在样式或主题中使用字体属性"><a href="#在样式或主题中使用字体属性" class="headerlink" title="在样式或主题中使用字体属性"></a>在样式或主题中使用字体属性</h3><p>首先定义一个样式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Text"</span> &gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"customFont"</span>&gt;</span>fonts/gtw.ttf<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时应用样式的主要问题就是如何使用 AttributeSet 解析出其中的字体属性，方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(attrs.getAttributeName(i).equals(<span class="string">"style"</span>))&#123;</span><br><span class="line">    <span class="keyword">int</span> styleId = attrs.getStyleAttribute();</span><br><span class="line">   TypedArray ta = obtainStyledAttributes(styleId, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;R.attr.customFont&#125;);</span><br><span class="line">   String path = ta.getString(<span class="number">1</span>);</span><br><span class="line">   ta.recycle();</span><br><span class="line">   Typeface typeface = Typeface.createFromAsset(getAssets(), path);</span><br><span class="line">   ((TextView)view).setTypeface(typeface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果在主题中定义了字体属性，因为 <strong>AttributeSet 中不会有未使用的属性出现，自然就解析不出字体属性了。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"customfont"</span>&gt;</span>fonts/gtw.ttf<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这时应该用主题对象(Theme)来解析出字体属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    View view = factory2.onCreateView(parent, name, context, attrs);</span><br><span class="line">    <span class="keyword">if</span>(view <span class="keyword">instanceof</span> TextView &amp;&amp; attrs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        TypedArray ta = getTheme().obtainStyledAttributes(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;</span><br><span class="line">            android.R.attr.colorAccent,  <span class="comment">//这里必须要以系统属性开头，否则自定义属性将解析错误</span></span><br><span class="line">            R.attr.customFont,           <span class="comment">//原因有待探索</span></span><br><span class="line">         &#125;);</span><br><span class="line">        String path = ta.getString(<span class="number">1</span>);</span><br><span class="line">        ta.recycle();</span><br><span class="line">        Typeface typeface = Typeface.createFromAsset(getAssets(), path);</span><br><span class="line">        ((TextView)view).setTypeface(typeface);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最后在实现时应该处理获取属性的优先级，一般而言，直接定义的优先级最高，style其次，主题再次之。</p>
</blockquote>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/28/android/View/Menu,PopupWindow和Dialog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2017/08/28/android/View/Menu,PopupWindow和Dialog/" class="post-title-link" itemprop="url">Menu,PopupWindow和Dialog</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2017-08-28 21:26:26" itemprop="dateCreated datePublished" datetime="2017-08-28T21:26:26+08:00">2017-08-28</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-18 15:33:08" itemprop="dateModified" datetime="2019-09-18T15:33:08+08:00">2019-09-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/View/" itemprop="url" rel="index"><span itemprop="name">View</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>12k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>11 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="PopupWindow"><a href="#PopupWindow" class="headerlink" title="PopupWindow"></a><a href="http://liangjingkanji.coding.me/2017/02/11/PopupWindow/" target="_blank" rel="noopener">PopupWindow</a></h2><p>PopupWindow 的根本构造是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内容控件不能有 parent</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PopupWindow</span><span class="params">(View contentView, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">boolean</span> focusable)</span></span></span><br></pre></td></tr></table></figure>
<p>本质上是利用 WindowManager 将 View 添加到屏幕上去，这也是它为何有包括 内容布局，尺寸，是否聚焦，Transition动画，BackgroundDrawable，Elevation，AnimationStyle等在内众多参数的原因，这些参数为 WindowManager.LayoutParams 所必须。</p>
<p>值得一提的是动画类型 AnimationStyle 是 style定义的，如果要改变动画类型，亦需要提供 style 资源。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"popupwindow_anim_style"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowEnterAnimation"</span>&gt;</span>@android:anim/fade_in<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowExitAnimation"</span>&gt;</span>@android:anim/fade_out<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>PopupWindow 在屏幕上显示的方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此处 View 主要是提供窗口服务的 IBinder 对象，因此随便一个控件即可以。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showAtLocation</span><span class="params">(View parent, <span class="keyword">int</span> gravity, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br></pre></td></tr></table></figure>
<p><strong>应该注意的是内容控件被套了两层 FrameLayout 的包装，第一层设置 BackgrondDrawable，第二场才被设置 WindowManager.LayoutParams 参数并添加到屏幕上去。</strong></p>
<p>也可以使用下列方法来显示，不过期参数已经指向左上角</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showAsDropDown</span><span class="params">(View anchor)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="动画效果"><a href="#动画效果" class="headerlink" title="动画效果"></a>动画效果</h3><p>设置 AnimationStyle 可以达到动画效果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"PopupW"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowEnterAnimation"</span>&gt;</span>@anim/slide_in_left<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowExitAnimation"</span>&gt;</span>@anim/slide_out_right<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 23 以上，还可以采用Transition 达到动画效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.setEnterTransition(<span class="keyword">new</span> TransitionSet().addTransition(<span class="keyword">new</span> Slide(Gravity.BOTTOM)));</span><br><span class="line">p.setExitTransition(<span class="keyword">new</span> TransitionSet().addTransition(<span class="keyword">new</span> Slide(Gravity.RIGHT)));</span><br></pre></td></tr></table></figure>
<h2 id="菜单"><a href="#菜单" class="headerlink" title="菜单"></a>菜单</h2><p>菜单包括如活动中的Option和Context菜单，Toolbar上的菜单，Navi上的菜单以及 PopupMenu 等等。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"更多"</span>&gt;</span>    </span><br><span class="line">  </span><br><span class="line">      <span class="tag">&lt;<span class="name">menu</span>&gt;</span>            </span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"设置"</span>/&gt;</span>            </span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"关于"</span>/&gt;</span>        </span><br><span class="line">      <span class="tag">&lt;/<span class="name">menu</span>&gt;</span>    </span><br><span class="line">  </span><br><span class="line">      <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:id</span>=<span class="string">"@+id/action_search"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_action_search"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:title</span>=<span class="string">"@string/action_search"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">app:showAsAction</span>=<span class="string">"collapseActionView|always|withText"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">app:actionViewClass</span>=<span class="string">"android.support.v7.widget.SearchView"</span> /&gt;</span>      </span><br><span class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MenuInflater 类负责将XML文件实例化为 Menu 对象，其对于 Menu ，Group，SubMenu 等标签有不同的解析方法。</p>
<p><strong>菜单中的 ActionView，可以改变菜单外观，如搜索框中所含的 SearchView 控件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MenuItem searchItem = menu.findItem(R.id.action_search);</span><br><span class="line">SearchView searchView = (SearchView) searchItem.getActionView();</span><br><span class="line">MenuItemCompat.setOnActionExpandListener(searchItem, ...);</span><br><span class="line">MenuItemCompat.expandActionView(searchItem);</span><br></pre></td></tr></table></figure>
<p>你也可以主动为菜单设置 ActionView。</p>
<h3 id="PopupMenu"><a href="#PopupMenu" class="headerlink" title="PopupMenu"></a><a href="http://liangjingkanji.coding.me/2017/02/11/PopupMenu/" target="_blank" rel="noopener">PopupMenu</a></h3><p>PopupMenu 内部有一个 Menu 对象，将xml资源加载到该对象上，显示在锚定控件下方，可以指定对齐方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PopupMenu popupMenu = <span class="keyword">new</span> PopupMenu(<span class="keyword">this</span>, textView);</span><br><span class="line">popupMenu.getMenuInflater().inflate(R.menu.main, popupMenu.getMenu());</span><br><span class="line">textView.setOnTouchListener(popupMenu.getDragToOpenListener());</span><br><span class="line">popupMenu.show();</span><br></pre></td></tr></table></figure>
<h3 id="关于-OverflowButton"><a href="#关于-OverflowButton" class="headerlink" title="关于 OverflowButton"></a>关于 OverflowButton</h3><p>1.是否永久显示 <strong>overflow菜单</strong>？</p>
<p>使用反射修改 ViewConfiguration 的 sHasPermanentMenuKey 参数既可以永久显示。</p>
<p>2.获取并修改 Overflow 按钮</p>
<p>a.可以使用主题修改</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name=<span class="string">"AppTheme"</span> parent=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><br><span class="line">    &lt;item name="android:actionOverflowButtonStyle"&gt;@style/OverflowStyle&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;style name=<span class="string">"OverflowStyle"</span>&gt;</span><br><span class="line">    &lt;item name="android:src"&gt;@android:drawable/arrow_up_float&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>b.可以使用代码修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;View&gt; outViews = <span class="keyword">new</span> ArrayList&lt;View&gt;();</span><br><span class="line">String overflowDescription = activity.getString(<span class="string">"more options"</span>);</span><br><span class="line">decorView.findViewsWithText(outViews, overflowDescription, View.FIND_VIEWS_WITH_CONTENT_DESCRIPTION);</span><br><span class="line">TintImageView overflow=(TintImageView) outViews.get(<span class="number">0</span>);</span><br><span class="line">overflow.setImageResource(imageID);</span><br></pre></td></tr></table></figure>
<h2 id="Dialog"><a href="#Dialog" class="headerlink" title="Dialog"></a>Dialog</h2><p>实际上 Activity 只要使用 Dialog 主题就可以看做Dialog，但 Dialog 实际上是没有生命周期的。</p>
<p>主要的话框是 AlertDialog，以及较新的 DialogFragment 和 BottomDialog ，也包括一些特定功能的对话框如 ProgressDialog，颜色，日期等。</p>
<p>AlertDialog 只不过预设了大量布局且可以根据构造方法来选择控件而已，这里提一下单选和多选对话框的使用。创建时应使用适配器，这样可以在对话框上添加条目</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Builder <span class="title">setAdapter</span><span class="params">(<span class="keyword">final</span> ListAdapter adapter, <span class="keyword">final</span> OnClickListener listener)</span></span></span><br></pre></td></tr></table></figure>
<p>ProgressDialog 的实现原理就是内置了一个 ProgressDialog 。</p>
<h3 id="BottomSheetDialog"><a href="#BottomSheetDialog" class="headerlink" title="BottomSheetDialog"></a>BottomSheetDialog</h3><p>使用方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BottomSheetDialog dialog=<span class="keyword">new</span> BottomSheetDialog(<span class="keyword">this</span>);</span><br><span class="line">dialog.setContentView(dialogView);</span><br><span class="line">dialog.show();</span><br></pre></td></tr></table></figure>
<p>这里设置布局时加入布局时做了一番手脚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> View <span class="title">wrapInBottomSheet</span><span class="params">(<span class="keyword">int</span> layoutResId, View view, ViewGroup.LayoutParams params)</span> </span>&#123;</span><br><span class="line">    CoordinatorLayout coordinator = inflate(context,</span><br><span class="line">            R.layout.design_bottom_sheet_dialog, <span class="keyword">null</span>);</span><br><span class="line">    FrameLayout bottomSheet = (FrameLayout) coordinator.findViewById(R.id.design_bottom_sheet);</span><br><span class="line">    mBehavior = BottomSheetBehavior.from(bottomSheet);</span><br><span class="line">    mBehavior.setBottomSheetCallback(mBottomSheetCallback);</span><br><span class="line">    bottomSheet.addView(view, params);</span><br><span class="line">    coordinator.findViewById(R.id.touch_outside).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (mCancelable &amp;&amp; isShowing() &amp;&amp; shouldWindowCloseOnTouchOutside()) &#123;</span><br><span class="line">                cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> coordinator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里设置布局后，将载入一个 CoordinatorLayout，其中有一个 FrameLayout，配置 BottomSheetBehavior，并将内容添加进去。</p>
<p>加载的主题是 <code>Window.FEATURE_NO_TITLE</code>，即没有标题的对话框。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> BottomSheetBehavior&lt;FrameLayout&gt; mBehavior;</span><br></pre></td></tr></table></figure>
<h3 id="DialogFragment"><a href="#DialogFragment" class="headerlink" title="DialogFragment"></a>DialogFragment</h3><p>使用 DialogFragment 是因为 Dialog 无生命周期，在横竖屏切换时会导致丢失对话框，而 DialogFragment 本质是一个带 Dialog 对象的碎片，能够恢复和重建 。</p>
<p>实际上它不需要重写 onCreateView 方法来建立视图，只需要重写下列方法建立 Dialog 对象即可，真正显示的是 Dialog 对象而不是视图。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span></span></span><br></pre></td></tr></table></figure>
<p>而后我们使用下列方法显示对话框</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(FragmentManager manager, String tag)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">show</span><span class="params">(FragmentTransaction transaction, String tag)</span></span></span><br></pre></td></tr></table></figure>
<p>这实际是添加到任务栈，用第二个方法你可以的碎片在栈中的 id。这样碎片就会追随所依附活动的状态，一旦碎片处于 onStart 状态 Dialog 就会显示，而 碎片处于 onStop 状态时 Dialog 就会隐藏(不是dismiss)。</p>
<p>如果突然关闭所在页面，活动销毁会导致碎片销毁视图，经历 DestroyView 状态，则 Dialog 消失(即dismiss)，接着会触发碎片的销毁，一般而言是将碎片出栈，以释放内存。</p>
<p>此外下列方法也将完成碎片的释放</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dismiss</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>问题1：显示的是 Dialog 还是 View？</strong></p>
<p>下列方法被改写了，这在创建视图时也影响了 Dialog 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> LayoutInflater <span class="title">getLayoutInflater</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (!mShowsDialog) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getLayoutInflater(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">    mDialog = onCreateDialog(savedInstanceState);</span><br><span class="line">    <span class="keyword">if</span> (mDialog != <span class="keyword">null</span>) &#123;</span><br><span class="line">        setupDialog(mDialog, mStyle);</span><br><span class="line">        <span class="keyword">return</span> (LayoutInflater) mDialog.getContext().getSystemService(</span><br><span class="line">                Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (LayoutInflater) mHost.getContext().getSystemService(</span><br><span class="line">            Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先 mShowsDialog 标记了是否显示对话框，如果其为 false，那么正常加载视图进行显示。</p>
<p>而后创建 Dialog 对象，在 onActivityCreated 方法中将决定显示哪个？如果同时设置了 View，则将 View 作为 Dialog 的内容视图，此外还要给 Dialog 打上 dismiss 监听器，保证碎片的释放。</p>
<p><strong>因此如果想采用所创建的对话框，第一要保证 mShowsDialog 标记为真，第二不要画蛇添足去实现 onCreateView 方法。</strong></p>
<h3 id="更改-Dialog-主题"><a href="#更改-Dialog-主题" class="headerlink" title="更改 Dialog 主题"></a>更改 Dialog 主题</h3><p>以下是V7包里 AlertDialog 的实际布局，实际是由 <strong>标题块(带分割线)，message块，自定义块和按钮块</strong> 组成的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/parentPanel"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/topPanel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/title_template"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:id</span>=<span class="string">"@+id/icon"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">"@drawable/ic_dialog_info"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">com.android.internal.widget.DialogTitle</span> <span class="attr">android:id</span>=<span class="string">"@+id/alertTitle"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"?android:attr/textAppearanceLarge"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:singleLine</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:id</span>=<span class="string">"@+id/titleDivider"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">"@android:drawable/divider_horizontal_dark"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/contentPanel&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">        &lt;ScrollView android:id="</span>@+<span class="attr">id</span>/<span class="attr">scrollView</span>"&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">"@+id/message"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"?android:attr/textAppearanceMedium"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/customPanel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">android:id</span>=<span class="string">"@+android:id/custom"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/buttonPanel"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">style</span>=<span class="string">"?android:attr/buttonBarStyle"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/leftSpacer"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"0.25"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:visibility</span>=<span class="string">"gone"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">"@+id/button1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"?android:attr/buttonBarButtonStyle"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">"@+id/button3"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">"center_horizontal"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"?android:attr/buttonBarButtonStyle"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">"@+id/button2"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"?android:attr/buttonBarButtonStyle"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:id</span>=<span class="string">"@+id/rightSpacer"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"0.25"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:visibility</span>=<span class="string">"gone"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>想要修改主题可以用如下构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>, R.style.Test);</span><br></pre></td></tr></table></figure>
<p>这里可以传入主题，也可以传入样式，其中主题 id 均大于 0x01000000，如果是样式，则将样式应用到主题上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.getTheme().resolveAttribute(R.attr.alertDialogTheme, outValue, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Dialog-的扩展-布局定制和动画效果"><a href="#Dialog-的扩展-布局定制和动画效果" class="headerlink" title="Dialog 的扩展:布局定制和动画效果"></a>Dialog 的扩展:布局定制和动画效果</h3><p>Dialog 的扩展主要包括两个方面：布局定制和动画效果。</p>
<p>想实现 Dialog 的入场动画效果，最简单的方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dialog.setOnShowListener(<span class="keyword">new</span> DialogInterface.OnShowListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShow</span><span class="params">(DialogInterface d)</span> </span>&#123;</span><br><span class="line">        View view = dialog.getWindow().getDecorView();</span><br><span class="line">        view.animate().rotation(<span class="number">360</span>).setDuration(<span class="number">2000</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这种方法即在 DecorView 做动画，但局限性很大。</p>
<p><strong>更一般的方式是定制一个布局，或像 BottomSheetDialog 那样，对传入的布局采用 wrap 操作；最终留出根布局的接口，以便对此进行动画。</strong></p>
<p>布局定制的核心是改造 onCreate 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.app_bar_main); </span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动画效果的核心是设置具体的动画效果，对于显示动画，可以放在 OnShowListener 接口中，因为该接口执行的时候，布局已经添加到 Dialog 中去了，但对于消失动画而已，则无法利用 onDiamissListener 接口，因此此接口执行时，布局已经被移除。</p>
<p>此时，可以通过改造 dismiss 方法来实现消失动画。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dismiss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    animatorSet = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line">    setupAnim();</span><br><span class="line">    animatorSet.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">            AnimDialog.<span class="keyword">super</span>.dismiss();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    animatorSet.resume();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>这个方法一定要具体的子类( 此处是AnimDialog)来执行，不能交给父类AlertDialog执行，因此创建一个构造方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AnimDialog <span class="title">create</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AnimDialog(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="动画的具体效果"><a href="#动画的具体效果" class="headerlink" title="动画的具体效果"></a>动画的具体效果</h3><p><strong>rotationY 是绕着y轴旋转的，为了动画之后显示正常，结束值应该设置为0。起始值如果为正，就是侧对着的感觉，有“掀开”的感觉。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"rotationY"</span>, -<span class="number">90</span>, <span class="number">0</span>).setDuration(mDuration)</span><br></pre></td></tr></table></figure>
<p><strong>rotation 是绕着z轴旋转的，所有旋转操作的中心点都在中心处。</strong></p>
<p><strong>translationX等是平移的效果，改变方向可以取得从四边滑入的效果，也可以取得震动效果</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"translationX"</span>, <span class="number">0</span>, .<span class="number">10f</span>, -<span class="number">25</span>, .<span class="number">26f</span>, <span class="number">25</span>,.<span class="number">42f</span>, -<span class="number">25</span>, .<span class="number">58f</span>, <span class="number">25</span>,.<span class="number">74f</span>,-<span class="number">25</span>,.<span class="number">90f</span>,<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><strong>scaleX等可以取得展开和收缩的效果。</strong></p>
<p>复合效果1：左侧旋转滚入，一般而言此类效果的方向是垂直的，从左侧滚入，那么旋转就是绕Y轴的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"rotationY"</span>, <span class="number">90</span>, <span class="number">0</span>).setDuration(<span class="number">2000</span>), <span class="comment">//负责旋转ObjectAnimator.ofFloat(view, "translationX", -300, 0).setDuration(2000), //负责左侧ObjectAnimator.ofFloat(view, "alpha", 0, 1).setDuration(2000*3/2)</span></span><br></pre></td></tr></table></figure>
<p>复合效果2：弹出展开与收缩展开</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"rotationY"</span>, <span class="number">90</span>,<span class="number">88</span>,<span class="number">88</span>,<span class="number">45</span>,<span class="number">0</span>).setDuration(<span class="number">2000</span>),</span><br><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"alpha"</span>, <span class="number">0</span>,<span class="number">0.4f</span>,<span class="number">0.8f</span>, <span class="number">1</span>).setDuration(<span class="number">2000</span>*<span class="number">3</span>/<span class="number">2</span>),</span><br><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"scaleX"</span>, <span class="number">0</span>,<span class="number">0.5f</span>, <span class="number">0.9f</span>, <span class="number">0.9f</span>, <span class="number">1</span>).setDuration(<span class="number">2000</span>),</span><br><span class="line">ObjectAnimator.ofFloat(view,<span class="string">"scaleY"</span>,<span class="number">0</span>,<span class="number">0.5f</span>, <span class="number">0.9f</span>, <span class="number">0.9f</span>, <span class="number">1</span>).setDuration(<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<p>弹出展开的特殊例子是新闻风格，核心是快速旋转多个来回。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"rotation"</span>, <span class="number">1080</span>,<span class="number">720</span>,<span class="number">360</span>,<span class="number">0</span>).setDuration(<span class="number">2000</span>),</span><br><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"alpha"</span>, <span class="number">0</span>, <span class="number">1</span>).setDuration(<span class="number">2000</span>*<span class="number">3</span>/<span class="number">2</span>),</span><br><span class="line">ObjectAnimator.ofFloat(view, <span class="string">"scaleX"</span>, <span class="number">0.1f</span>, <span class="number">0.5f</span>, <span class="number">1</span>).setDuration(<span class="number">2000</span>),</span><br><span class="line">ObjectAnimator.ofFloat(view,<span class="string">"scaleY"</span>,<span class="number">0.1f</span>,<span class="number">0.5f</span>,<span class="number">1</span>).setDuration(<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<h3 id="广告对话框"><a href="#广告对话框" class="headerlink" title="广告对话框"></a><a href="https://github.com/yipianfengye/android-adDialog" target="_blank" rel="noopener">广告对话框</a></h3><p><img src="https://github.com/yipianfengye/android-adDialog/raw/master/images/ezgif.com-video-to-gif1.gif" alt="广告对话框"></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/24/android/View/一些有意思的 View/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2017/08/24/android/View/一些有意思的 View/" class="post-title-link" itemprop="url">一些有意思的 View</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2017-08-24 09:26:26" itemprop="dateCreated datePublished" datetime="2017-08-24T09:26:26+08:00">2017-08-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-18 15:10:43" itemprop="dateModified" datetime="2019-09-18T15:10:43+08:00">2019-09-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/View/" itemprop="url" rel="index"><span itemprop="name">View</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>2.7k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>2 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>自定义View的套路包括以下四种。</p>
<h2 id="绘制效果型"><a href="#绘制效果型" class="headerlink" title="绘制效果型"></a>绘制效果型</h2><p>直接使用 Canvas 添加绘制效果是最简单的一种套路。例如<a href="https://github.com/Jichensheng/BaiduWave" target="_blank" rel="noopener">BaiduWave</a>的效果不过是通过截断 Canvas 来实现的。</p>
<img src="/2017/08/24/android/View/一些有意思的%20View/baidu.gif">
<p>又比如<a href="https://github.com/SparkYuan/SubmitButton" target="_blank" rel="noopener">SubmitButton</a>的动画效果看起来很华丽，但可以将其过程拆成几段分别进行绘制。</p>
<img src="/2017/08/24/android/View/一些有意思的%20View/submitbutton.gif">
<h3 id="PatternLockView"><a href="#PatternLockView" class="headerlink" title="PatternLockView"></a><a href="https://github.com/aritraroy/PatternLockView" target="_blank" rel="noopener">PatternLockView</a></h3><p><img src="https://github.com/aritraroy/PatternLockView/raw/master/screenshots/pattern_lock_view_small.gif?raw=true" alt="PatternLockView"></p>
<p>PatternLockView 的绘制效果还与触摸事件有关，属于此类型中较为复杂的。</p>
<h2 id="偷梁换柱型"><a href="#偷梁换柱型" class="headerlink" title="偷梁换柱型"></a>偷梁换柱型</h2><p>偷梁换柱型指的是在原生的系统控件上添加或替换控件，典型的例子就是 <a href="https://github.com/AlexLiuSheng/BadgeView" target="_blank" rel="noopener">BadgeView</a>。</p>
<img src="/2017/08/24/android/View/一些有意思的%20View/version1.0.5.png">
<p>BadgeView 是怎样实现给已经存在的控件“打上”标记呢？</p>
<p>将原来的控件(如 ImageView)从视图树中移除，但记录它的布局参数，ID等信息。而后新建一个 FrameLayout ，将ImageView 和准备好的角标加入这个布局，最后将 FrameLayout 添加到视图树中去，并复原它的 id ，布局参数等信息。</p>
<blockquote>
<p>实际上要实现 Badger 效果，完全可以靠扩展控件的 onDraw 方法来实现，不过这种实现没有通用性。</p>
</blockquote>
<p><a href="https://github.com/tyrantgit/ExplosionField" target="_blank" rel="noopener">升级版的BadgeView</a>还实现了动画效果。</p>
<img src="/2017/08/24/android/View/一些有意思的%20View/8f5ab3aa-5db8-11e6-808c-6033f5d5c4ec.gif">
<h3 id="AndroidResideMenu"><a href="#AndroidResideMenu" class="headerlink" title="AndroidResideMenu"></a><a href="https://github.com/SpecialCyCi/AndroidResideMenu" target="_blank" rel="noopener">AndroidResideMenu</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/2.gif">
<p>AndroidResideMenu 在Activity的根布局中插入新布局，点击后用动画。还要处理 Activity 的 dispatchTouchEvent方法。</p>
<h3 id="ShowcaseView"><a href="#ShowcaseView" class="headerlink" title="ShowcaseView"></a><a href="https://github.com/amlcurran/ShowcaseView" target="_blank" rel="noopener">ShowcaseView</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/example2@2x.png">
<h3 id="TapTargetView"><a href="#TapTargetView" class="headerlink" title="TapTargetView"></a><a href="https://github.com/KeepSafe/TapTargetView" target="_blank" rel="noopener">TapTargetView</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/screenshot1.png">
<p>TapTargetView 显示 SpannableString作为提示。</p>
<h2 id="GuillotineMenu-Android"><a href="#GuillotineMenu-Android" class="headerlink" title="GuillotineMenu-Android"></a><a href="https://github.com/Yalantis/GuillotineMenu-Android" target="_blank" rel="noopener">GuillotineMenu-Android</a></h2><img src="/2017/08/24/android/View/一些有意思的%20View/68747.gif">
<p>这个库的交互方式非常有意思，它将换上的布局旋转-90度隐藏起来，而后执行动画显示。难点在于如何处理遮挡NaviMenu的问题。</p>
<h2 id="组合排列型"><a href="#组合排列型" class="headerlink" title="组合排列型"></a>组合排列型</h2><p>组合排列型是将几种控件组合在容器中，也是较为简单和常用的方法。</p>
<h3 id="SpaceTabLayout"><a href="#SpaceTabLayout" class="headerlink" title="SpaceTabLayout"></a><a href="https://github.com/thelong1EU/SpaceTabLayout" target="_blank" rel="noopener"><strong>SpaceTabLayout</strong></a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/3.gif">
<p>这里是将组合和绘制结合在一起了。</p>
<h3 id="AndroidTreeView"><a href="#AndroidTreeView" class="headerlink" title="AndroidTreeView"></a><a href="https://github.com/bmelnychuk/AndroidTreeView" target="_blank" rel="noopener">AndroidTreeView</a></h3>
<p>这个树结构的View是纯粹的排列组合式，不过特殊之处在于要设计节点的的数据结构，即树。节点的抽象类TreeNode如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> TreeNode mParent; </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> List&lt;TreeNode&gt; children;</span><br><span class="line">  <span class="keyword">private</span> BaseNodeViewHolder mViewHolder;<span class="comment">//布局</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>各层的容器实际是 LinearLayout。获得根节点后，将每一个子节点中的布局添加进去即可，唯一值得注意的是这个一个递归过程，你还可以决定是否要扩展或收缩整个布局以及是否使用动画效果。</p>
<h2 id="动画驱动型"><a href="#动画驱动型" class="headerlink" title="动画驱动型"></a>动画驱动型</h2><p>动画驱动型泛指为添加动画行为，与其它几种类型可以同时使用。例如 <a href="https://github.com/flavioarfaria/KenBurnsView" target="_blank" rel="noopener">KenBurnsView</a>就是在ImageView上应用属性动画而已。</p>
<img src="/2017/08/24/android/View/一些有意思的%20View/anim.gif">
<p>在比如<a href="https://github.com/varunest/SparkButton" target="_blank" rel="noopener">SparkButton</a>是对自定义的绘制效果使用动画。</p>

<h3 id="FloatingView"><a href="#FloatingView" class="headerlink" title="FloatingView"></a><a href="https://github.com/UFreedom/FloatingView" target="_blank" rel="noopener">FloatingView</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/demo.gif">
<p>FloatingView 是偷懒换柱的实现，兼备动画效果。</p>
<p>FloatingView 在 DecorView 上添加了一层 FrameLayout，确定 anchorView 在屏幕上的位置将其在添加的FrameLayout上复制，并执行动画。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Rect rect = <span class="keyword">new</span> Rect();</span><br><span class="line">anchorView.getGlobalVisibleRect(rect);</span><br><span class="line"><span class="keyword">int</span>[] location = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">mFloatingDecorView.getLocationOnScreen(location);</span><br><span class="line">rect.offset(-location[<span class="number">0</span>], -location[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">//anchorView 的测量和布局</span></span><br><span class="line">mFloatingDecorView.addView(targetView,lp);</span><br><span class="line"><span class="comment">//此后是应用动画</span></span><br></pre></td></tr></table></figure>
<p>类似的是<a href="https://github.com/tyrantgit/HeartLayout" target="_blank" rel="noopener">HeartLayout</a></p>
<img src="/2017/08/24/android/View/一些有意思的%20View/heartlayout.gif">
<h3 id="folding-cell-android"><a href="#folding-cell-android" class="headerlink" title="folding-cell-android"></a><a href="https://github.com/Ramotion/folding-cell-android" target="_blank" rel="noopener">folding-cell-android</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/folding_cell_preview.gif">
<p>使用翻页动画来显示简介和详情，有意思的交互。</p>
<p>FoldingCell 本身是一个容器，将若干个布局折叠存放起来，点击时对这些页执行动画。</p>
<h3 id="AndroidFillableLoaders"><a href="#AndroidFillableLoaders" class="headerlink" title="AndroidFillableLoaders"></a><a href="https://github.com/JorgeCastilloPrz/AndroidFillableLoaders" target="_blank" rel="noopener">AndroidFillableLoaders</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/demoWaves.gif">
<h3 id="VectAlign"><a href="#VectAlign" class="headerlink" title="VectAlign"></a><a href="https://github.com/bonnyfone/vectalign" target="_blank" rel="noopener">VectAlign</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/6966.gif">
<h3 id="AndroidViewHover"><a href="#AndroidViewHover" class="headerlink" title="AndroidViewHover"></a><a href="https://github.com/daimajia/AndroidViewHover" target="_blank" rel="noopener">AndroidViewHover</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/76966.gif">
<h3 id="Grav"><a href="#Grav" class="headerlink" title="Grav"></a><a href="https://github.com/glomadrian/Grav" target="_blank" rel="noopener">Grav</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/login.gif">
<h2 id="综合使用"><a href="#综合使用" class="headerlink" title="综合使用"></a>综合使用</h2><p>例如<a href="https://github.com/Yalantis/Context-Menu.Android" target="_blank" rel="noopener">Context-Menu</a>这个库同时使用了偷梁换柱和组合排列，还添加了动画效果。</p>
<img src="/2017/08/24/android/View/一些有意思的%20View/8745.gif">
<p>有一些效果有多种实现方式，例如文字的跑马灯效果，可以纯粹绘制路径的方式实现，也可以用控件的组合的方式实现。</p>
<p><a href="https://github.com/oubowu/MarqueeLayoutLibrary" target="_blank" rel="noopener">MarqueeLayoutLibrary</a>将控件并排排列，每一个子控件的尺寸都与容器相同，利用 Scroller 产生滚动效果。</p>

<p><a href="https://github.com/sdsmdg/RotatingText" target="_blank" rel="noopener">RotatingText</a></p>
<img src="/2017/08/24/android/View/一些有意思的%20View/gif_cover.gif">
<p>则采用直接绘制的方式完成。</p>
<h3 id="DiagonalLayout"><a href="#DiagonalLayout" class="headerlink" title="DiagonalLayout"></a><a href="https://github.com/florent37/DiagonalLayout" target="_blank" rel="noopener">DiagonalLayout</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/sample.gif">
<h3 id="StepView"><a href="#StepView" class="headerlink" title="StepView"></a><a href="https://github.com/baoyachi/StepView" target="_blank" rel="noopener">StepView</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/snapshot.png">
<p>StepView 是组合控件兼顾了绘制效果，它本身是一个 LinearLayout，容纳的布局如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.baoyachi.stepview.HorizontalStepsViewIndicator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/steps_indicator"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>"/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/rl_text_container"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中RelativeLayout负责容纳TextView控件， HorizontalStepsViewIndicator 负责绘制效果。</p>
<h3 id="NavigationTabBar"><a href="#NavigationTabBar" class="headerlink" title="NavigationTabBar"></a><a href="https://github.com/Devlight/NavigationTabBar" target="_blank" rel="noopener">NavigationTabBar</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/54645.gif">
<h3 id="TapBarMenu"><a href="#TapBarMenu" class="headerlink" title="TapBarMenu"></a><a href="https://github.com/michaldrabik/TapBarMenu" target="_blank" rel="noopener">TapBarMenu</a></h3><img src="/2017/08/24/android/View/一些有意思的%20View/2e676966.gif">

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/20/android/View/一些提示性的控件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2017/08/20/android/View/一些提示性的控件/" class="post-title-link" itemprop="url">一些提示性的控件</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2017-08-20 14:28:29" itemprop="dateCreated datePublished" datetime="2017-08-20T14:28:29+08:00">2017-08-20</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-18 15:21:08" itemprop="dateModified" datetime="2019-09-18T15:21:08+08:00">2019-09-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/View/" itemprop="url" rel="index"><span itemprop="name">View</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>5.1k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>5 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>提示性的控件代表了着一种典型的自定义控件的实现思路，即<strong>在某个布局上添加自定义的布局。</strong></p>
<p>像系统定义的 Toast，Dialog，甚至 Activity 都是在 Window 上添加自定义布局，SnackBar 则是在 CoordinatorLayout 布局上添加自定义布局，以便利用自定义的 Behavior 类。</p>
<p>在具体实现上，不同的控件根据实现效果还要考虑 IPC 过程，动画效果，触摸事件等。</p>
<h2 id="Toast"><a href="#Toast" class="headerlink" title="Toast"></a>Toast</h2><p>Toast 是一个系统提供的提示性控件，<strong>本质和 PopupWindow 一样，是在 Window 上添加和移除 View</strong>，所以最重要的是设置 View，否则显示的时候将出现异常。它的使用分为两步</p>
<p>1.构造。</p>
<p>常用的 makeText 方法即构造了一个只包括 TextView 的布局，<strong>如果要设置文本，必须将其 id 设置为android.R.id.message。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Toast <span class="title">makeText</span><span class="params">(Context context, CharSequence text, @Duration <span class="keyword">int</span> duration)</span> </span>&#123;</span><br><span class="line">    Toast result = <span class="keyword">new</span> Toast(context);</span><br><span class="line">    View v = inflate.inflate(com.android.internal.R.layout.transient_notification, <span class="keyword">null</span>);</span><br><span class="line">    TextView tv = (TextView)v.findViewById(com.android.internal.R.id.message);</span><br><span class="line">    tv.setText(text);</span><br><span class="line">    </span><br><span class="line">    result.mNextView = v;</span><br><span class="line">    result.mDuration = duration;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.显示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mNextView == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"setView must have been called"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    tn.mNextView = mNextView;</span><br><span class="line">    INotificationManager service = getService();</span><br><span class="line">    String pkg = mContext.getOpPackageName();</span><br><span class="line">    TN tn = mTN;</span><br><span class="line">    service.enqueueToast(pkg, tn, mDuration);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显示的过程是一个 IPC 过程，这是为了避免与其他应用的 Toast 冲突。显示 Toast 依靠 Handler 来实现，本质是通过 WindowManager 服务添加 mNextView 来实现的。<strong>Toast 可以配置的参数都应用在WindowManager.LayoutParams 上。 包括 gravity，偏移量，margin等。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WindowManager mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">mParams.gravity = gravity;</span><br><span class="line">mWM.addView(mView, mParams);</span><br></pre></td></tr></table></figure>
<h3 id="自定义View"><a href="#自定义View" class="headerlink" title="自定义View"></a>自定义View</h3><p>因为可以设置 View，故而可以通过自定义 View 来实现各种效果，甚至可以通过 onAttachedToWindow 方法来获得动画效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onAttachedToWindow();</span><br><span class="line">    ValueAnimator va = ValueAnimator.ofInt(Color.GREEN, Color.CYAN).setDuration(<span class="number">1500</span>);</span><br><span class="line">    va.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">            drawable.setColor((Integer) animation.getAnimatedValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    va.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SnackBar"><a href="#SnackBar" class="headerlink" title="SnackBar"></a>SnackBar</h2><p>SnackBar 比 Toast 要轻量，它也要防止冲突，但并非通过 IPC 机制来完成。</p>
<p>首先是构建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Snackbar <span class="title">make</span><span class="params">(View view, <span class="keyword">int</span> resId, @Duration <span class="keyword">int</span> duration)</span></span></span><br></pre></td></tr></table></figure>
<p>这里的 View 只用来寻找 Parent 布局，或者是 CoordinatorLayout 或者是 android.R.id.content，而后是加载 SnackbarLayout 到布局。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ViewGroup mTargetParent;</span><br><span class="line"><span class="keyword">final</span> SnackbarLayout mView;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Snackbar</span><span class="params">(ViewGroup parent)</span> </span>&#123;</span><br><span class="line">    mTargetParent = parent;</span><br><span class="line">    mView = (SnackbarLayout) inflater.inflate(</span><br><span class="line">            R.layout.design_layout_snackbar, mTargetParent, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 SnackbarLayout 是一个线性布局，它采用 LayoutInflate 将带 merge 标签的布局加载进自己</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">merge</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">"@+id/snackbar_text"</span>"/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">"@+id/snackbar_action"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"?attr/colorAccent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"?attr/borderlessButtonStyle"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">merge</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样 setAction 方法就是此 Button 点击事件的委托处理，点击将执行 dispatchDismiss 方法，</p>
<p>show 方法交给 SnackbarManager 来处理，这个类管理两个 SnackbarRecord 实例，以避免叠加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> SnackbarRecord mCurrentSnackbar;</span><br><span class="line"><span class="keyword">private</span> SnackbarRecord mNextSnackbar;</span><br></pre></td></tr></table></figure>
<p>显示的时候，要取消当前，实例化和显示后者，SnackbarRecord 实际就是一个包装了功能的回调，其执行内容为 Callback 的 show 方法。真实的显示方法为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">showView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mView.getParent() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> ViewGroup.LayoutParams lp = mView.getLayoutParams();</span><br><span class="line">        <span class="keyword">if</span> (lp <span class="keyword">instanceof</span> CoordinatorLayout.LayoutParams) &#123;</span><br><span class="line">            CoordinatorLayout.LayoutParams clp = (CoordinatorLayout.LayoutParams) lp;</span><br><span class="line">            Behavior behavior = <span class="keyword">new</span> Behavior();</span><br><span class="line">            behavior.setListener(<span class="keyword">new</span> SwipeDismissBehavior.OnDismissListener());</span><br><span class="line">            clp.setBehavior(behavior);</span><br><span class="line">            clp.insetEdge = Gravity.BOTTOM;</span><br><span class="line">        &#125;</span><br><span class="line">        mTargetParent.addView(mView);</span><br><span class="line">        <span class="comment">//使用动画</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里 SnackbarLayout 将配置上 SwipeDismissBehavior，该类决定了其行为。SwipeDismissBehavior 是一个提供 swipe-to-dismiss 的类，依靠 ViewDragHelper 实现，</p>
<h3 id="FloatingToolbar"><a href="#FloatingToolbar" class="headerlink" title="FloatingToolbar"></a><a href="https://github.com/rubensousa/FloatingToolbar" target="_blank" rel="noopener">FloatingToolbar</a></h3><p>FloatingToolbar 是模仿 Snackbar 实现的一个库。</p>
<img src="/2017/08/20/android/View/一些提示性的控件/demo.gif">
<p>如果将动画放慢，就会发现首先 Fab 先消失(alpha动画)，而后 FloatingToolbar 才扩展出现(scaleX动画)，因此主要的工作是设置和添加布局。</p>
<p>FloatingToolbar 是一个线性布局，可以添加自定义布局，也可以添加菜单。Fab 的点击事件发生后，将执行动画显示；如果再点击菜单中的控件，将执行各自ItemClick，并执行隐藏操作。</p>
<p>FloatingToolbar 的优点还在于考虑了与Snackbar 冲突的情况，通过添加 OnScrollListener 来在 RecyclerView 滑动时隐藏 FloatingToolbar 。</p>
<p><strong>FloatingToolbar 需要在自定义布局，虽然有自由度，但没有 Snackbar 封装的那么好，而且也没有利用Behavior类。</strong></p>
<p>Fab 的点击事件发生后，将执行动画显示；如果再点击菜单中的控件，将执行各自ItemClick，并执行隐藏操作。</p>
<h2 id="Alert"><a href="#Alert" class="headerlink" title="Alert"></a><a href="https://github.com/Tapadoo/Alerter" target="_blank" rel="noopener">Alert</a></h2><img src="/2017/08/20/android/View/一些提示性的控件/alert_default.gif">
<p>与之类似还有<a href="https://github.com/code-mc/loadtoast" target="_blank" rel="noopener">LoadToast</a>， 原理是在 Window 上添加控件，并使用动画来显示。</p>
<h2 id="通知"><a href="#通知" class="headerlink" title="通知"></a><a href="http://hukai.me/android-training-course-in-chinese/ux/notify-user/index.html" target="_blank" rel="noopener">通知</a></h2><p>服务 NotificationManager 将通知展示在状态栏处，属于跨进程通信。</p>
<p>其中 Notification 类是 Parcelable 对象，包装了通知所需的数据，包括关于信息的，关于布局的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</span><br><span class="line">Notification compat = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .setSmallIcon(R.drawable.boot)</span><br><span class="line">        .setContentText(<span class="string">"通知必须有：标题，内容和显示在状态栏的Small图标"</span>)</span><br><span class="line">        .setContentTitle(<span class="string">"标题"</span>)</span><br><span class="line">        .setLargeIcon(BitmapFactory.decodeResource(getResources(), R.drawable.beauty))</span><br><span class="line">        .setSubText(<span class="string">"子标题"</span>)          </span><br><span class="line">        .setCustomBigContentView(remoteViews) <span class="comment">//大图</span></span><br><span class="line">        .setAutoCancel(<span class="keyword">true</span>) <span class="comment">//点击取消</span></span><br><span class="line">        .setTicker(<span class="string">"通知"</span>) <span class="comment">//显示在状态栏的标题</span></span><br><span class="line">        .setDefaults(Notification.DEFAULT_ALL) <span class="comment">//效果</span></span><br><span class="line">        .build();</span><br><span class="line">manager.notify(<span class="string">"like"</span>, <span class="number">6</span>, compat);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通知必须有：标题，内容和显示在状态栏的Small图标</p>
</blockquote>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/18/android/View/与Drawable相关的实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiang">
      <meta itemprop="description" content="谨守而勿失，是谓反其真">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lxt">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2017/08/18/android/View/与Drawable相关的实践/" class="post-title-link" itemprop="url">与Drawable相关的实践</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2017-08-18 21:26:26" itemprop="dateCreated datePublished" datetime="2017-08-18T21:26:26+08:00">2017-08-18</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-18 14:22:40" itemprop="dateModified" datetime="2019-09-18T14:22:40+08:00">2019-09-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/View/" itemprop="url" rel="index"><span itemprop="name">View</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>4.7k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>4 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>Drawable 是 Android 绘制机制的代表</strong>，很多时候实现绘制效果并不需要自定义控件，这里谈谈如何自定义 Drawable 以及如何<strong>产生动画效果</strong>。</p>
<h3 id="自定义Drawable的典型例子：FadeDrawable-Picasso"><a href="#自定义Drawable的典型例子：FadeDrawable-Picasso" class="headerlink" title="自定义Drawable的典型例子：FadeDrawable(Picasso)"></a>自定义Drawable的典型例子：FadeDrawable(Picasso)</h3><p>Picasso 中加载完 Bitmap 后有一个渐显效果，这是通过自定义 FadeDrawable 来实现的，其简单逻辑如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FadeDrawable</span> <span class="keyword">extends</span> <span class="title">BitmapDrawable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mStartTime = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mDuration = <span class="number">2000</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">        <span class="keyword">long</span> time = System.currentTimeMillis() - mStartTime;</span><br><span class="line">        <span class="keyword">if</span>(time&lt;mDuration)&#123;</span><br><span class="line">            <span class="keyword">int</span> alpha = (<span class="keyword">int</span>) (<span class="number">255</span> * max(<span class="number">0</span>, time) / mDuration);</span><br><span class="line">            setAlpha(alpha);</span><br><span class="line">            invalidateSelf();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setAlpha(<span class="number">255</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fade</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mStartTime = System.currentTimeMillis();</span><br><span class="line">        invalidateSelf();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样调用 fade() 方法后，在两秒内将有一个渐显得动画效果出现。</p>
<p>实际上这个效果还可以通过属性动画来实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ValueAnimator va = ValueAnimator.ofInt(<span class="number">0</span>, <span class="number">255</span>).setDuration(<span class="number">2000</span>);</span><br><span class="line">va.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                bitmapDrawable.setAlpha((Integer) animation.getAnimatedValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">va.start();</span><br></pre></td></tr></table></figure>
<p>这是通过操纵 bitmapDrawable 对象来实现的，实际还可以直接操作 ImageView 控件来实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mImageView.animate().alpha(<span class="number">1f</span>).withLayer().setDuration(<span class="number">2000</span>).start();</span><br></pre></td></tr></table></figure>
<p>这三种方法第三种间接，第一种封装性好，适合广泛性。</p>
<blockquote>
<p>自定义 Drawable 的典型方法就是通过<strong>设置参数来控制绘制效果</strong>，既可以<strong>通过设置条件来终结重绘过程，亦可以直接使用属性动画。</strong></p>
</blockquote>
<h3 id="PathDrawable-及动画"><a href="#PathDrawable-及动画" class="headerlink" title="PathDrawable 及动画"></a>PathDrawable 及动画</h3><p><strong>通过构建路径具备相当的灵活性，可以实现什么绘制效果主要取决于想象力。</strong></p>
<p>应该注意到路径的初始化应该放在如下方法中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onBoundsChange</span><span class="params">(Rect bounds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onBoundsChange(bounds);</span><br><span class="line">    createPath();</span><br></pre></td></tr></table></figure>
<p>其次记录路径的描述点最好使用二维数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">float</span>[][] as = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">2</span>][<span class="number">5</span>];</span><br></pre></td></tr></table></figure>
<p>这样可以便于构建对象的属性对象(Property)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Property&lt;View, <span class="keyword">float</span>[][]&gt; mBProperty = <span class="keyword">new</span> Property&lt;View, <span class="keyword">float</span>[][]&gt;(<span class="keyword">float</span>[][].class, <span class="string">"bs"</span>)</span><br></pre></td></tr></table></figure>
<p>例如抽屉控件中的 DrawerArrowDrawable 就是一个典型的 PathDrawable，且有动画效果。它的绘制效果是绘制三条线，同时采用一个 process 参数(float)来控制线的起始位置和长度，以及旋转角度。其实现可以简化为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    Rect bounds = getBounds();</span><br><span class="line">    <span class="keyword">int</span> width = bounds.width();</span><br><span class="line">    <span class="keyword">int</span> height = bounds.height();</span><br><span class="line">    <span class="keyword">float</span> midX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> midY = bounds.centerY();</span><br><span class="line">    <span class="keyword">float</span> topY = lerp(midY - height / <span class="number">3</span>, midY, mProgress);</span><br><span class="line">    <span class="keyword">float</span> botY = lerp(midY + height / <span class="number">3</span>, midY, mProgress);</span><br><span class="line">    <span class="keyword">float</span> dx = lerp(width, width / <span class="number">2</span>, mProgress);</span><br><span class="line">    mPath.rewind();</span><br><span class="line">    <span class="comment">// draw middle bar</span></span><br><span class="line">    mPath.moveTo(midX, midY);</span><br><span class="line">    mPath.rLineTo(width, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// bottom bar</span></span><br><span class="line">    mPath.moveTo(midX, botY);</span><br><span class="line">    mPath.rLineTo(dx, midY + height / <span class="number">3</span> - botY);</span><br><span class="line">    <span class="comment">// top bar</span></span><br><span class="line">    mPath.moveTo(midX, topY);</span><br><span class="line">    mPath.rLineTo(dx, midY - height / <span class="number">3</span> - topY); </span><br><span class="line">    mPath.close();</span><br><span class="line">    canvas.save();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">float</span> rotate = lerp(<span class="number">0</span>, <span class="number">270</span>, mProgress);  <span class="comment">//将 Path 旋转，区间为[0, 270]</span></span><br><span class="line">    canvas.rotate(rotate, bounds.centerX(), bounds.centerY());</span><br><span class="line">    canvas.drawPath(mPath, mPaint);</span><br><span class="line">    canvas.restore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样绘制路径就被 mProcess 参数完全控制了，可以对其使用属性动画。</p>
<h3 id="TextDrawable"><a href="#TextDrawable" class="headerlink" title="TextDrawable"></a><a href="https://github.com/amulyakhare/TextDrawable" target="_blank" rel="noopener">TextDrawable</a></h3><img src="/2017/08/18/android/View/与Drawable相关的实践/screen1-material.png">
<p>TextDrawable 继承 ShapeDrawable，它之所以能够绘制文字和底边是使用 Paint 的结果，绘制文字的核心代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">    Rect r = getBounds();</span><br><span class="line">    <span class="keyword">int</span> count = canvas.save();</span><br><span class="line">    canvas.translate(r.left, r.top);</span><br><span class="line">    <span class="keyword">int</span> width = <span class="keyword">this</span>.width &lt; <span class="number">0</span> ? r.width() : <span class="keyword">this</span>.width;</span><br><span class="line">    <span class="keyword">int</span> height = <span class="keyword">this</span>.height &lt; <span class="number">0</span> ? r.height() : <span class="keyword">this</span>.height; </span><br><span class="line">    <span class="comment">//字体尺寸不超过高度的一半</span></span><br><span class="line">    <span class="keyword">int</span> fontSize = <span class="keyword">this</span>.fontSize &lt; <span class="number">0</span> ? (Math.min(width, height) / <span class="number">2</span>) : <span class="keyword">this</span>.fontSize;</span><br><span class="line">    textPaint.setTextSize(fontSize);</span><br><span class="line">    canvas.drawText(text, width / <span class="number">2</span>, height / <span class="number">2</span> - ((textPaint.descent() + textPaint.ascent()) / <span class="number">2</span>), textPaint);</span><br><span class="line">    canvas.restoreToCount(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里画笔的对齐方式设置成居中 Paint.Align.CENTER，绘制点在水平方向上位于半宽度，<strong>在垂直方向上需要得到 baselinde 的位置，而不是垂直居中的位置。</strong></p>
<p><strong>以字体尺寸为 24sp 的 Paint 而言，其 ascent 值为 -22.265625， descent 值为 5.859375，二者的差值即为从中线向下的偏移量。</strong></p>
<p>该库的使用时应该有个有意思的点：</p>
<p><strong>1.用两个 TextDrawable 合成 LayerDrawable，造成各占据一边的结果</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Drawable[] layerList = &#123;</span><br><span class="line">        <span class="keyword">new</span> InsetDrawable(left, <span class="number">0</span>, <span class="number">0</span>, toPx(<span class="number">31</span>), <span class="number">0</span>),</span><br><span class="line">        <span class="keyword">new</span> InsetDrawable(right, toPx(<span class="number">31</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> LayerDrawable(layerList);</span><br></pre></td></tr></table></figure>
<p><strong>2.形成 AnimationDrawable 帧动画。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AnimationDrawable animationDrawable = <span class="keyword">new</span> AnimationDrawable();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">    TextDrawable frame = builder.build(String.valueOf(i), mGenerator.getRandomColor());</span><br><span class="line">    animationDrawable.addFrame(frame, <span class="number">1200</span>);</span><br><span class="line">&#125;</span><br><span class="line">animationDrawable.setOneShot(<span class="keyword">false</span>);</span><br><span class="line">animationDrawable.start();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样实现的动画效果，实际并不聪明，浪费内存。</p>
</blockquote>
<h2 id="MaterialProgressDrawable-SwipeRefreshLayout"><a href="#MaterialProgressDrawable-SwipeRefreshLayout" class="headerlink" title="MaterialProgressDrawable(SwipeRefreshLayout)"></a>MaterialProgressDrawable(SwipeRefreshLayout)</h2><p>MaterialProgressDrawable 是一个典型的循环动画 Drawable，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Rect bounds = getBounds();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> saveCount = c.save();</span><br><span class="line">    c.rotate(mRotation, bounds.exactCenterX(), bounds.exactCenterY());</span><br><span class="line">    mRing.draw(c, bounds);</span><br><span class="line">    c.restoreToCount(saveCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从绘制方法上看，动画效果是通过rotate操作达成的，具体绘制委托给了 Ring 对象。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/1.jpg"
      alt="xiang">
  <p class="site-author-name" itemprop="name">xiang</p>
  <div class="site-description" itemprop="description">谨守而勿失，是谓反其真</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/liuxiangtian" title="GitHub &rarr; https://github.com/liuxiangtian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="http://www.zhihu.com/people/liu-xiang-tian-74" title="zhihu &rarr; http://www.zhihu.com/people/liu-xiang-tian-74" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>zhihu</a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘祥</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">191k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:53</span>
</div>



        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script><script src="/js/bookmark.js?v=7.4.0"></script>



  





















  

  
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    
  

  

  

</body>
</html>
